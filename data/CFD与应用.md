<a id="catalog">目录</a>

[TOC]

# 第一章：离散化的基本方法

[目录](#catalog)

## 一、学习路线

​		详细讨论“离散化”一词的含义。假设有一个二维流场，控制方程是纳维-斯托克斯方程，也可以是欧拉方程。这些方程都是偏微分方程。这些方程的解析解理论上以封闭形式的表达式将$u、v、p、\rho$等表示成$x、y$ 的函数。用这些表达式，可以在流场中任意指定的点上得到流场变量的值。也就是说，可以在无穷多个$（x，y）$点上得到流场变量的值。

​		但是，如果这些控制方程中的偏导数被换成一组近似的代数差分（下一节将推导代数差分，它们只用图<img src="离散化的基本方法.assets/1627453373984.png" style="zoom:65%"/>中两个或多个离散网格点上的流场变量进行表述)，那么微分方程就完全被一组代数方程所代替。解这个代数方程组，能得到流场变量在离散网格点上的值。从这个意义上讲，原来的偏微分方程被“离散化”了，而这种离散化的方法叫做有限差分方法。CFD中广泛使用有限差分方法，因此笔记的多数内容都是关于有限差分的。

​		上面解释了离散化的含义。CFD中的所有方法都使用了某种形式的离散化。笔记的目的就是推导并讨论当前有限差分方法中用到的离散化的更一般形式，所以“有限差分”成为**学习路线图**中三个主要标题中的一个。**学习路线图**实际上是《离散化的基本方法》笔记的路线图。图中其余两个主要标题分别是“有限体积”和“有限元”。有限体积方法和有限元方法多年来在计算力学中有着广泛的应用（但笔记不去讨论这两种方法）。但要指出，CFD可以用这三种离散化方法——有限差分、有限体积或有限元中的任何一种进行处理。

<img src="离散化的基本方法.assets/1627454365956.png" style="zoom:95%"/>



## 二、有限差分基础

[目录](#catalog)

#### 1.有限差分模板

​		讨论用适当的代数差分（即有限差分）来代替偏导数。用泰勒级数展开可以推导出导数的有限差分的一般形式。例如，如果用 $u$ 表示速度的 $x$ 分量在$（i，j）$点的值，则$（i+1，j）$点的速度分量 $u$，可以用$（i，j）$点的泰勒级数展开表示：
$$
u_{i+1,j}=u_{i,j}+(\frac{\partial u}{\partial x})_{i,j}\Delta x+(\frac{\partial^{2} u}{\partial x^{2}})_{i,j}\frac{(\Delta x)^{2}}{2!}+(\frac{\partial^{3} u}{\partial x^{3}})_{i,j}\frac{(\Delta x)^{3}}{3!}\tag{*}
$$
​		这里只给出一个例子，以下给出常用的有限差分模板，更多推导看**《计算流体力学基础及其应用》第4章。**

---

$x$方向一阶导数的一阶向前差分$(\frac{\partial u}{\partial x})_{i，j}=\frac{u_{i+1，j}-u_{i，j}}{\Delta x}\tag{1}$​

![1627457328093](离散化的基本方法.assets/1627457328093.png)

---

$x$方向一阶导数的一阶向后差分$(\frac{\partial u}{\partial x})_{i，j}=\frac{u_{i，j}-u_{i-1，j}}{\Delta x}\tag{2}$

![1627457414511](离散化的基本方法.assets/1627457414511.png)

---

$x$方向一阶导数的二阶中心差分$(\frac{\partial u}{\partial x})_{i，j}=\frac{u_{i+1，j}-u_{i-1，j}}{2\Delta x}\tag{3}$

![1627457538497](离散化的基本方法.assets/1627457538497.png)

---

$x$​方向二阶导数的二阶中心差分$(\frac{\partial^{2} u}{\partial x^{2}})_{i，j}=\frac{u_{i+1，j}-2u_{i，j}+u_{i-1，j}}{(\Delta x)^{2}}\tag{4}$​

![1627457655926](离散化的基本方法.assets/1627457655926.png)

---

$y$方向一阶导数的一阶向前差分$(\frac{\partial u}{\partial y})_{i，j}=\frac{u_{i，j+1}-u_{i，j}}{\Delta y}\tag{5}$

![1627457732023](离散化的基本方法.assets/1627457732023.png)

---

$y$方向一阶导数的一阶向后差分$(\frac{\partial u}{\partial y})_{i，j}=\frac{u_{i，j+1}-u_{i，j}}{\Delta y}\tag{6}$

![1627457822420](离散化的基本方法.assets/1627457822420.png)

---

$y$方向一阶导数的二阶中心差分$(\frac{\partial u}{\partial y})_{i，j}=\frac{u_{i，j+1}-u_{i，j-1}}{2\Delta y}\tag{7}$

![1627457922484](离散化的基本方法.assets/1627457922484.png)

---



$y$方向二阶导数的二阶中心差分$(\frac{\partial^{2} u}{\partial y^{2}})_{i，j}=\frac{u_{i，j+1}-2u_{i，j}+u_{i，j-1}}{(\Delta y)^{2}}\tag{8}$

![1627458098549](离散化的基本方法.assets/1627458098549.png)

---

二阶混合导数的二阶中心差分$(\frac{\partial^{2} u}{\partial x\partial y})_{i，j}=\frac{u_{i+1，j+1}+u_{i-1，j-1}-u_{i-1，j+1}-u_{i+1，j-1}}{4\Delta x\Delta y}\tag{9}$

![1627458371763](离散化的基本方法.assets/1627458371763.png)

---

​		强调指出，随着精度的不断提高，可以推导出无穷无尽的有限差分表达式。过去的大多数CFD应用，二阶精度已经足够了，所以以上所推导的各种差分公式都是最常用的。

​		至于高阶精度公式，对它们的优缺点有以下观点：

​		（1）缺点：高阶精度的差分需要更多的网格点，比如式（4-18)。所以计算中的每一个时间步或空间步都需要更多的计算机时间。
​		（2）优点：要得到相同精度的流场解，如果使用高阶差分格式，流场中网格点的总数可以更少--些。
​		（3）优点：高阶差分格式可以给出质量更高的流场解。例如，捕捉到的激波更陡、更清晰。事实上，这正是当前CFD研究的一个方面。

---

[目录](#catalog)

#### 2.边界上怎样构造差分近似

​		考虑这样一个问题：在边界上怎样构造差分近似？在边界上，只有一个方向是指向流场内部的，应该用什么样的差分？<img src="离散化的基本方法.assets/1627461316590.png" style="zoom:60%" />***图（边界网格点）***所示的一段流场边界。假设y方向与边界垂直，点1在边界上，点2和点3在边界上方，到边界的距离分别为$\Delta y$和$2\Delta y$。要在边界上构造$\frac{\partial u}{\partial y}$的有限差分近似。

​		**向前差分$(\frac{\partial u}{\partial y})_1=\frac{u_2-u_1}{\Delta y}+O(\Delta y) $**很容易得到，但只有一阶精度。

​		如果想得到二阶精度的有限差分呢？**中心差分式$(\frac{\partial u}{\partial y})_{i，j}=\frac{u_{i，j+1}-u_{i，j-1}}{2\Delta y}$**在这里不能用，因为它要用到边界下面的一个点（即***图（边界网格点）***中的点**2'**)。

​		点**$2'$**在计算区域之外，一般是得不到u在这点上的信息的。早期的CFD，许多计算都通过假设$u_{2^{'}}= u_{2}$来回避这个问题，这种处理称为反射边界条件。在很多情况下，这样处理是没有物理意义的，而且也并不比**向前差分式$(\frac{\partial u}{\partial y})_1=\frac{u_2-u_1}{\Delta y}+O(\Delta y) $**更精确。所以要再思考―遍：在边界上如何得到二阶精度的有限差分？

​		同时，学习构造有限差分的另外一种方法。它不同于前面的泰勒级数分析，而是一种多项式近似。假设在***图（边界网格点）***所示的边界上，$u$可以表示成多项式
$$
u=a+by+cy^{2}\tag{1}
$$
​		将此式逐步用到***图（边界网格点）***中的各个网格点上。

​		在网格点1，$y =0$，式（1）给出$u_1=a\tag{2}$

​		在网格点2，$y = \Delta y$，给出$u_2=a+b\Delta y+c(\Delta y)^{2}\tag{3}$

​		在网格点3，$y =2\Delta y$，给出$u_3=a+b(2\Delta y)+c(2\Delta y)^2\tag{4}$

​		从（2）~（4）上式解出$b$，得到 $b=\frac{-3 u+4 u_2-u_3}{2\Delta y}\tag{5}$

​		将式（1）对 $y$ 求导，得到$\frac{\partial u}{\partial y}=b+2 c y\tag{6}$

​		将式（6）在边界$y =0$处求值，就有$(\frac{\partial u}{\partial y})_1=b\tag{7}$

​		从式（5）和式（7），最终得到$(\frac{\partial u}{\partial y})_1=\frac{-3 u+4 u_2-u_3}{2\Delta y}\tag{8}$

​		式（8）是边界上导数的单侧差分表达式。之所以称为单侧的，是因为它只用到了边界一侧的网格点（比如***图（边界网格点）***中，只用到点1上方的网格点）上的信息。此外，式（8）是用多项式（1）导出的，而不是用泰勒级数导出的。这个例子说明了构造有限差分的另一种方法。

​		事实上，**有限差分模板**的所有公式都可以用这种多项式方法推导出来。接下来，给出式(4-27)精度的阶。为此，借助泰勒级数，考虑点1处的泰勒级数展开：
$$
u(y)=u_1+(\frac{\partial u}{\partial y})_{1}y+(\frac{\partial^{2} u}{\partial y^{2}})_{1}\frac{y^{2}}{2}+(\frac{\partial^{3} u}{\partial y^{3}})_{1}\frac{y^{3}}{3!}+···\tag{9}
$$
​		将式（9）与式（1）对比一下。假设多项式表达式（1）与泰勒级数中前三项表示的结果相同，则式（1）的量级为$O(\Delta y)^{3}$。

​		再考察（8）的分子，其中的$u_1、u_2、u_3$都可以用多项式（1）表示。

​		既然式（1）的量级是$O(\Delta y)^{3}$，那么式（8）的分子也是$O(\Delta y)^{3}$。然而，用式（8）近似导数时还要再除以$2 \Delta y$，所以式（8）本身的量级是$O(\Delta y)^{2}$。

​		于是，由式（8），有$(\frac{\partial u}{\partial y})_1=\frac{-3 u+4 u_2-u_3}{2\Delta y}+O(\Delta y)^{2}\tag{10}$

这正是所求的边界上的二阶精度差分。

​		**向前差分$(\frac{\partial u}{\partial y})_1=\frac{u_2-u_1}{\Delta y}+O(\Delta y) $**和**式（10）**都叫做单侧差分，因为它们作为导数在某一点的近似值，只用到函数在该点一侧的值。单侧差分精度越高，计算结果相应的就越精确。



## 三、差分方程

[目录](#catalog)

​		偏微分方程中包含了许多偏导数项，对一个给定的偏微分方程，如果将其中所有的偏导数都用有限差分来代替，所得到的代数方程叫做差分方程，它是偏微分方程的代数表示。

​		CFD中有限差分方法的基础，就是用差分代替流动控制方程里的偏导数，得到关于未知函数在每一网格点处的值的差分代数方程组。

​		考虑非定常一维热传导方程（热传导系数为常数)：
$$
\frac{\partial T}{\partial t}=\alpha \frac{\partial^{2}T}{\partial x^{2}}\tag{1}
$$
​		方程（1）中有两个自变量$x$和$t$。考虑<img src="离散化的基本方法.assets/1627466473243.png" style="zoom:60%"/>***图差分网格***，其中，$i$是$x$方向的标号，$n$是$t$方向的标号。如果偏微分方程的一个自变量是用于推进求解的变量，如方程（1）中的$t$，按照CFD的习惯，这个推进变量方向的标号就用$n$来表示，并且在有限差分表达式中写成上标。例如，如果我们用**向前差分式**代替方程（1）中的时间导数，就是
$$
(\frac{\partial T}{\partial t})_{i}^{n}=\frac{T_{i}^{n+1}-T_{i}^{n}}{\Delta t}-(\frac{\partial^{2}T}{\partial t^{2}})_{i}^{n}\frac{\Delta t}{2}+···\tag{2}
$$
​		用**中心差分式**代替方程（1）中的$x$方向导数，即
$$
(\frac{\partial^{2} T}{\partial t^{2}})_{i}^{n}=\frac{T_{i+1}^{n}-2 T_{i}^{n}+T_{i-1}^{n}}{(\Delta x)^{2}}-(\frac{\partial^{4}T}{\partial x^{4}})_{i}^{n}\frac{(\Delta x)^{2}}{12}+···\tag{3}
$$
​		如果将方程（1）写成
$$
\frac{\partial T}{\partial t}-\alpha \frac{\partial^{2}T}{\partial x^{2}}=0\tag{4}
$$
​		将式（2）和式（3）代入式（4），有
$$
\overbrace{\frac{\partial T}{\partial t}-\alpha \frac{\partial^{2}T}{\partial x^{2}}=0}^{偏微分方程}=\underbrace{\frac{T_{i}^{n+1}-T_{i}^{n}}{\Delta t}-\frac{\alpha(T_{i+1}^{n}-2 T_{i}^{n}+T_{i-1}^{n})}{(\Delta x)^{2}}}_{差分方程}+
$$

$$
\underbrace{[-(\frac{\partial^{2}T}{\partial t^{2}})_{i}^{n}\frac{\Delta t}{2}+\alpha(\frac{\partial^{4}T}{\partial x^{4}})_{i}^{n}\frac{(\Delta x)^{2}}{12}+···]}_{截断误差}\tag{5}
$$

​		考察式（5），左边就是原来的偏微分方程，右边前两项是原方程的差分表示，方括号里的项是差分方程的截断误差。

​		将式（5）中的差分方程单独写出来，就是：
$$
\frac{T_{i}^{n+1}-T_{i}^{n}}{\Delta t}=\alpha\frac{(T_{i+1}^{n}-2 T_{i}^{n}+T_{i-1}^{n})}{(\Delta x)^{2}}\tag{6}
$$
​		方程（6）就是用来表示原微分方程（1）的差分方程。但方程（6）仅是方程（1）的一个近似。由于用在方程（6）中的每一个有限差分都带有截断误差，所以最终形成的差分方程本身也就有了截断误差，它是每一个有限差分的截断误差的总和。式（5）中给出了差分方程（6）的截断误差，注意这个差分方程的截断误差是$O[\Delta t，( \Delta x)^{2}]$。

​		**重点：差分方程与原微分方程并不相同，它们完全是两个不同的东西。差分方程是一个代数方程。**

​		如果在<img src="离散化的基本方法.assets/1627466473243.png" style="zoom:60%"/>***图差分网格***的区域内所有网格点上都列出这种差分方程，就得到一个联立的代数方程组。用某种方式数值求解这个代数方程组，就求出了未知函数在所有网格点上的值，即求出了$T_{i}^{n}，T_{i+1}^{n}，T_{i}^{n+1}，T_{i+1}^{n+1}，T_{i}^{n+2}$等等。

​		**理论上讲，应该能够指望数值解给出的$T$值代表了原微分方程封闭形式的解析解所给出的结果，至少在截断误差的范围内能这样。**

​		**当网格点的数量趋于无穷多**，也就是$\Delta x→0，\Delta t→0$时，差分方程能否还原成原来的微分方程呢？从式（5）可知，**此时截断误差也趋于零，从而差分方程确实趋近于原微分方程。**

​		在这种情况下，我们说偏微分方程的这个有限差分表示是相容的。

​		**假设差分方程是相容的，假设求解差分方程的数值方法是稳定的，再假设边界条件已经用合理的数值方法进行了处理，那么差分方程的数值解就应该能够代表微分方程的解析解，至少是在截断误差的范围之内是这样的。**

​		然而，这些“假设”，再加上截断误差在区域内来回传播，使得成功地进行CFD求解变成一种挑战，也使得CFD求解变得更像一门“艺术”，而不是一门“科学”。

## 四、显式方法与隐式方法

[目录](#catalog)

#### 1.显示方法

​		选定某种方法来求解给定的问题，会发现这种方法总是可以归结为两种不同的通用方法——显式方法或隐式方法中的一种。这两种基本方法代表了各种数值方法之间的根本区别。

​		考虑非定常一维热传导方程（热传导系数为常数)：
$$
\frac{\partial T}{\partial t}=\alpha \frac{\partial^{2}T}{\partial x^{2}}\tag{1}
$$
​		使用**向前差分**代替了$\frac{\partial T}{\partial t}$，使用**二阶导数的二阶精度中心差分**代替了$\frac{\partial^{2}T}{\partial x^{2}}$，得到了方程（2）这种特定形式的差分方程：
$$
\frac{T_{i}^{n+1}-T_{i}^{n}}{\Delta t}=\alpha\frac{(T_{i+1}^{n}-2 T_{i}^{n}+T_{i-1}^{n})}{(\Delta x)^{2}}\tag{2}
$$
​		整理后此式可写成：
$$
T_{i}^{n+1}=T_{i}^{n}+\alpha\frac{\Delta t}{(\Delta x)^{2}}(T_{i+1}^{n}-2 T_{i}^{n}+T_{i-1}^{n})\tag{3}
$$
​		假设在第$n$个时间层的每个网格点上，$T$的值都是已知的，时间推进就意味着第$n +1$个时间层每个网格上的T值都要用第$n$个时间层上的已知量计算出来。完成这种计算之后，第$n+1$个时间层所有网格点上的值也变成已知的了。再用同样的计算过程计算第$n +2$个时间层每个网格上的$T$值，也就是用第$n+1$个时间层上的已知量来计算第$n+2$个时间层每个网格点上的$T$值。

​		用这种沿着时间方向逐步推进的方式，可依次得到整个解。再把注意力放到式（3）上，就能从中发现实施这种时间推进最直接的途径。式（3）把第$n$个时间层上.的值写在了等式右边，第$n +1$个时间层上的值写在了左边。根据时间推进的原理，第$n$层上的值都是已知的，第$n +1$层上的值才是要计算的。

​		更重要的是，式（3）中只出现了一个要计算的量 $T_{i}^{n+1}$。所以，利用第n个时间层上的已知量，式（3）可用来直接求解 $T_{i}^{n+1}$，每一个方程只有一个未知数。

​		例如，在<img src="离散化的基本方法.assets/1627478446577.png" style="zoom:65%"/>***图时间推进*** 中，

​		沿x方向布置了七个网格点，在网格点$2$处，式（3）将写成
$$
T_{2}^{n+1}=T_{2}^{n}+\alpha\frac{\Delta t}{(\Delta x)^{2}}(T_{3}^{n}-2T_{2}^{n}+T_{1}^{n})
$$
​		此式可以直接计算$T_{2}^{n+1}$，因为此式右边的量都是已知的数。再考虑网格点$3$，此时式（3）写成
$$
T_{3}^{n+1}=T_{3}^{n}+\alpha\frac{\Delta t}{(\Delta x)^{2}}(T_{4}^{n}-2T_{3}^{n}+T_{2}^{n})\tag{4}
$$
​		用此式右边的已知量又可以直接算出$T_{3}^{n+1}$。按照这种方式，将式（3）相继用在网格点$4、5、6 上$，就可以依次得到$T_{4}^{n+1}$、$T_{5}^{n+1}$和$T_{6}^{n+1}$。

​		上一段的描述恰好给出了显式方法的计算过程。

​		于是，可以这样定义：显式方法中每一个差分方程只包含一个未知数，从而这个未知数可以用直接计算的方式显式地求解。显式方法是最简单的方法。<img src="离散化的基本方法.assets/1627479989544.png" style="zoom:65%"/>***图显式有限差分的模板*** 

​		用虚线围成的有限差分模板可以用来对显式方法作进一步的说明。该图的模板里只包含了第$n +1$个时间层的一个未知量。

​		至于***图显式有限差分的模板*** 中的网格点1和7，它们位于边界上，而推进求解抛物型偏微分方程时假设预先给定了边界条件。在***图显式有限差分的模板*** 中，$T_{1}$和$T_{7}$，分别代表$T$在左、右边界上的值。上述假设就意味着它们都可以由给定的边界条件确定，因而在每一个时间层上都是已知的。

[目录](#catalog)

#### 2.隐式方法

​		作为相反的例子，回到非定常一维热传导方程（热传导系数为常数)：
$$
\frac{\partial T}{\partial t}=\alpha \frac{\partial^{2}T}{\partial x^{2}}\tag{1}
$$
​		把右边的空间差分写成第$n$个时间层上的量与第$n +1$个时间层上的量的平均值，使用
$$
\frac{T_{i}^{n+1}-T_{i}^{n}}{\Delta t}=\alpha\frac{\frac{T_{i+1}^{n+1}+T_{i+1}^{n}}{2}-2(\frac{T_{i}^{n+1}+T_{i}^{n}}{2})+\frac{T_{i-1}^{n+1}+T_{i-1}^{n}}{2}}{(\Delta x)^{2}}\tag{2}
$$
来表示方程（1）。

​		式（2）中所用的这种特定形式的差分称为克兰克-尼科尔森格式。(Crank-Nicolson scheme被广泛用于求解控制方程是抛物型方程的问题。在$CFD$中，Crank-Nicolson scheme 及其改进形式，常常用于边界层方程的有限差分求解）。

​		再仔细考察一下式（2），未知量的表达式中不仅包含第$n$个时间层上的已知量$T_{i-1}^{n}$、$T_{i}^{n}$和$T_{i+1}^{n}$，还包含第n +1个时间层上的多个未知量，即：除了$T_{i}^{n+1}$之外还有$T_{i-1}^{n+1}$和$T_{i+1}^{n+1}$。

​		所以，用在网格点$i$上的差分方程（2）并不是独立的。靠它自己并不能给出的$T_{i}^{n+1}$解。相反，式（2）这样的方程必须在所有内点上列出，形成一个代数方程组。相应的未知数$T_{i}^{n+1}$（对所有的$i$)是从这个代数方程组中同时求解出来的，这就是隐式方法。

​		对于排列在同一时间层所有网格点上的未知量，必须将它们联立起来同时求解，才能求出这些未知量，这种方法就定义为隐式方法。

​		由于需要求解联立的代数方程组，隐式方法通常涉及大型矩阵的运算。于是，很容易得到这样的印象，隐式方法比前面讨论的显式方法需要更多、更复杂的计算。<img src="离散化的基本方法.assets/1627481895405.png" style="zoom:65%"/>***图隐式有限差分的模板***

​		图中清楚地画出了第$n+1$层上的三个未知量。

***具体例子参考笔记《伯格斯方程数值解》的毕姆——沃明隐式方案。***

[目录](#catalog)

#### 3.总结

**1.显式方法**

​		优点：方法的建立及编程相对简单。
​		缺点：根据上面的例子，对取定的$\Delta x$，$\Delta t$t必须小于稳定性条件对它提出的限制。在某些情形，$\Delta t$必须很小，才能保持稳定性。要将时间推进计算到时间变量的给定值，就需要很长的计算机运行时间。

**2.隐式方法**

​		优点：用大得多的$\Delta t$值也能保持稳定性。要将时间推进计算到时间变量的给定值，只需要少得多的时间步，这将使计算机运行时间更短。.
​		缺点：方法的建立和编程更复杂。而且，由于每一时间步的计算通常需要大量的矩阵运算，每一时间步的计算机运行的时间要比显式方法长得多。**另外，$\Delta t$取大的值，截断误差就大，隐式方法在跟踪严格的瞬态变化（未知函数随时间的变化）时可能不如显式方法精确。然而，对于以定常态为最终目标的时间相关算法，时间上够不够精确并不重要。**



## 五、误差与稳定性分析

[目录](#catalog)

​		关于数值方法稳定性性质的问题是由上一节显式方法引出来的。如果推进方向上的增量(在当时的例子中就是$\Delta t$）超过了某个预先设定的值，显式方法就变成数值不稳定的。从原理上讲，这个最大的可允许值，来自于对有限差分形式的控制方程所作的正式的稳定性分析。

​		但是对非线性的欧拉方程或纳维-斯托克斯方程的有限差分表示，还没有严格的稳定性分析。然而，还是有一些简化的方法，可以用到较为简单的模型方程上，并得到一些合理的指导性结论。

​		考虑非定常一维热传导方程（热传导系数为常数)：
$$
\frac{\partial T}{\partial t}=\alpha \frac{\partial^{2}T}{\partial x^{2}}\tag{1}
$$
​		选择使用**向前差分**代替了$\frac{\partial T}{\partial t}$，使用**二阶导数的二阶精度中心差分**代替了$\frac{\partial^{2}T}{\partial x^{2}}$，得到了方程（2）这种显示格式的差分方程：
$$
\frac{T_{i}^{n+1}-T_{i}^{n}}{\Delta t}=\alpha\frac{(T_{i+1}^{n}-2 T_{i}^{n}+T_{i-1}^{n})}{(\Delta x)^{2}}\tag{2}
$$
​		稳定性到底是什么？是什么使得-组给定的计算变成不稳定的？

​		这个问题的答案在很大程度上是建立在数值误差的基础之上。

​		**数值误差是执行一组给定的计算时所产生的误差。更准确地说，当计算过程从一个推进步进行到下一步时，数值误差的传播方式才是问题答案的基础。**

​		简述：在从一个推进步进行到下一步时，如果某个特定的数值误差被放大了，那么计算就变成不稳定。如果误差不增长，甚至在从一个推进步进行到下一步时，误差还在衰减，那么计算通常就是稳定的。

​		要考虑稳定性，就先要讨论数值误差。数值误差是什么？有什么样的行为方式？

​		考虑一个偏微分方程，这个方程的数值解受到两种误差的影响：

​		(1）离散误差		偏微分方程的精确解（解析解）与相应的差分方程的精确解（无舍入误差的解）之间的差。**按照三、差分方程的讨论，**离散误差就是差分方程的截断误差再加上对边界条件进行数值处理时引进误差。(从概念上讲，离散误差不能等同于截断误差。）**
​		(2）舍入误差		对数值进行多次重复计算产生的数值误差。因为计算机通常要将数值舍人到某个有效数字。
​		记
$$
A=偏微分方程的精确解\\
D=差分方程的精确解\\
N=在某个具有有限精\\度的计算机上实际计算出来的解\\
则离散误差=A-D\\
舍入误差=\epsilon=N -D
\tag{3}
$$
​		由上式，有$N=D+\epsilon\tag{4}$

​		其中 $\epsilon$ 是舍人误差，为笔记记录方便，有时就简称为误差。数值解$N$应该满足差分方程，因为在计算机上编程，解的就是差分方程。在现在的例子中，我们在计算机上通过编程，求解方程（2）所得到的结果已经带有了舍入误差。

​		所以，由方程有
$$
\frac{(D_{i}^{n+1}+\epsilon_{i}^{n+1})-(D_{i}^{n}+\epsilon_{i}^{n})}{\Delta t}=\alpha\frac{(D_{i+1}^{n}-\epsilon_{i+1}^{n})-2(D_{i}^{n}+\epsilon_{i}^{n})+(D_{i-1}^{n}+\epsilon_{i-1}^{n})}{(\Delta x)^{2}}\tag{5}
$$
​		根据定义，D是差分方程的精确解，所以它当然精确地满足差分方程，即
$$
\frac{D_{i}^{n+1}-D_{i}^{n}}{\Delta t}=\alpha\frac{D_{i+1}^{n}-2D_{i}^{n}+D_{i-1}^{n}}{(\Delta x)^{2}}\tag{6}
$$
​		从式（5）中减去式（6），得
$$
\frac{\epsilon_{i}^{n+1}-\epsilon_{i}^{n}}{\Delta t}=\alpha\frac{\epsilon_{i+1}^{n}-2\epsilon_{i}^{n}+\epsilon_{i-1}^{n}}{(\Delta x)^{2}}\tag{7}
$$
​		从式（7）以看出，误差$\epsilon$也满足差分方程。

​		考虑差分方程（2）的稳定性。假设在求解这个方程的某个阶段，误差 $\epsilon$ 已经存在了。当求解过程从第$n$步推进到第$n +1$步时，如果 $\epsilon$ 衰减，至少是不增大，那么求解就是稳定的；反之，如果$\epsilon$ 增大，求解就是不稳定的，应该有
$$
|\frac{\epsilon_{i}^{n+1}}{\epsilon_{i}^{n}}|\leq1\tag{8}
$$
​		从方程（2）出发，什么条件下式（8）才能成立?

​		推导过程见**《计算流体力学基础及其应用》第4章**。

​		要使上式成立，应该有
$$
\frac{\alpha\Delta t}{(\Delta x)^{2}}\leq\frac{1}{2}\tag{9}
$$
​		式（9）给出了一个稳定性条件，来保证差分方程（2）的解是稳定的。显然，对于给定的$\Delta x$ ，$\Delta t$的值必须足够小，才能满足式（9）。
​		它表明：对于显式有限差分格式，稳定性要求对推进变量有所限制。只要$\frac{\alpha\Delta t}{(\Delta x)^{2}}\leq\frac{1}{2}$，在t方向后面的推进中，误差都不会增大，数值解将呈现稳定的态势。

​		反之，如果$\frac{\alpha\Delta t}{(\Delta x)^{2}}\leq\frac{1}{2}$，误差将会持续增大，最终导致数值推进的解在计算机上”爆炸“或”湮灭“。

​		以上的分析作为一个例子，代表了一种通用的分析方法，叫做von Neumann（冯·诺伊曼）稳定性方法。这种方法常常用来研究线性差分方程的稳定性性质。



​		考虑一阶波动方程，即
$$
\frac{\partial u}{\partial t}+c\frac{\partial u}{\partial x}=0\tag{10}
$$
​		用中心差分代替式中的空间导数，有
$$
\frac{\partial u}{\partial x}=\frac{u_{i+1}^{n}-u_{i-1}^{n}}{2\Delta x}\tag{11}
$$
​		再用简单的向前差分代替时间导数，就给出了代表方程（10）的差分方程，形式为：
$$
\frac{u_{i}^{n+1}-u_{i}^{n}}{\Delta t}=-c\frac{u_{i+1}^{n}-u_{i-1}^{n}}{2\Delta x}\tag{11}
$$
​		将冯·诺伊曼稳定性分析应用于方程（11），得到的结果却表明，无论$\Delta t$如何取值，方程（11）总是给出不稳定的解。因此，方程（11）被称为无条件不稳定的。如果依旧使用一阶差分代替时间导数，但这次用两个网格点$i+1$和$i-1$上$u$的平均值来代表$u$，即
$$
u_{i}^{n}=\frac{1}{2}(u_{i+1}^{n}+u_{i-1}^{n})\tag{12}
$$
​		于是
$$
\frac{\partial u}{\partial t}=\frac{u_{i}^{n+1}-\frac{1}{2}(u_{i+1}^{n}+u_{i-1}^{n})}{\Delta t}\tag{13}
$$
​		将式（11）和式（13）代入式（10），有
$$
u_{i}^{n+1}=\frac{u_{i+1}^{n}+u_{i-1}^{n}}{2}-c\frac{\Delta t}{\Delta x}\frac{u_{i+1}^{n}+u_{i-1}^{n}}{2}\tag{14}
$$
​		上式中的差分，也就是用式（13）表示时间导数，叫做Lax(拉克斯)方法，数学家Peter Lax首先提出了这种方法。

​		**稳定性条件的推导过程见《计算流体力学基础及其应用》第4章。**

​		给出结论：
$$
C=|c|\frac{\Delta t}{\Delta x}\leq1\tag{15}
$$
​		式（15）中的$C$称为柯朗（Courant）数。此式表明，要使方程（14）的解是稳定的，，该有$\Delta t\leq\frac{\Delta x}{|c|}$。式（15）为称为柯朗-弗里德里奇—列维（Courant-Friedrichs-Lewy）条件，一般写成$CFL$条件，这个条件对双曲型方程来说是一个重要的稳定性准则

​		$CFL$条件的**详细含义及例子见《计算流体力学基础及其应用》第4章**。

​		可以为$CFL$条件作如下的**物理解释：要保证稳定性，数值解的依赖区域必须全部包含解析解的依赖区域。**



# 第二章：网格生成与坐标变换

## 一、学习路线

[目录](#catalog)

​		笔记的目的是：先给出偏微分控制方程在物理平面和计算平面之间的变换，然后讨论各种特殊网格。这部分内容是CFD研究中一个非常活跃的领域，称为网格生成。

​		从这种意义上来说，笔记只能记录一些皮毛。希望笔记的内容足以建立网格生成的基本思路和基本原理，并了解网格生成是如何与整个CFD结合在一起的。
​		<img src="../CFD%E5%9F%BA%E7%A1%80%E4%B8%8E%E5%BA%94%E7%94%A8/%E7%BD%91%E6%A0%BC%E7%94%9F%E6%88%90%E4%B8%8E%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2.assets/1627511260362.png" style="zoom:72%"/>***图学习路线*** 

图中左边的方框表示变换过程的各个方面，这些内容将被用在右边的方框所代表的网格生成的过程中。

<a id="transformation of the equation">.</a>

## 二、方程的一般变换

[目录](#catalog)

​		为简单起见，考虑二维非定常流场，其自变量为$x、y$和 $t$ 。对于自变量为 $x、y、z$ 和 $t$的 三维非定常流场，结果是类似的，只是包含了更多的项。

​		要将物理平面中的自变量（$x，y，t$）变换成计算平面中的一组新自变量（$\xi，\eta，\tau$），用方程
$$
\xi=\xi(x,y,t)\tag{1a}
$$

$$
\eta=\eta(x,y,t)\tag{1b}
$$

$$
\tau=\tau(t)\tag{1c}
$$

​		表示这个变换，目前这个变换是以一般形式写出来的。

​		对于实际应用，方程（1$a$~$c$）表示的变换必须由具体的解析关系式给出，有时也可以由特定的数值对应关系给出。在上述变换中，$\tau$只是 $t$ 的函数，并常常以$\tau=t$的形式给出，整个变换中必须包括式（1$c$），否则就无法生成某些必要的项。

 		考虑以x、y和t为自变量的一个或一-组偏微分方程，例如一般连续性方程、动量方程和能量方程。在这些方程中，未知函数是以导数的形式出现的，如$\frac{\partial \rho}{\partial x}，\frac{\partial u}{\partial y}，\frac{\partial e}{\partial t}$。因此，要将这些方程从$（x，y， t）$空间变换到$（\xi，\eta，T）$空间，需要对导数进行变换，也就是把原偏微分方程中关于 $x、y、t$ 的导数变换成关于$（\xi，\eta，T）$的导数。比如说，要用$\frac{\partial u}{\partial \xi}，\frac{\partial u}{\partial \eta}$等的某种组合来代替$\frac{\partial u}{\partial y}$。导数的变换可以由式(1$a$ ~ $c$）给出的变换关系用下述方法得到。

​		根据求导的链式法则，有
$$
\frac{\partial}{\partial x}=(\frac{\partial}{\partial \xi})(\frac{\partial \xi}{\partial x})+(\frac{\partial}{\partial \eta})(\frac{\partial \eta}{\partial x})\tag{2}
$$
​		类似地，有
$$
\frac{\partial}{\partial y}=(\frac{\partial}{\partial \xi})(\frac{\partial \xi}{\partial y})+(\frac{\partial}{\partial \eta})(\frac{\partial \eta}{\partial y})\tag{3}
$$
​		还有
$$
\frac{\partial}{\partial t}=(\frac{\partial}{\partial \xi})(\frac{\partial \xi}{\partial t})+(\frac{\partial}{\partial \eta})(\frac{\partial \eta}{\partial t})+(\frac{\partial}{\partial \tau})(\frac{d \tau}{d t})\tag{4}
$$
​		**式（2）、式（3）和式（4）可以将关于$x、y和t$的导数变换成关于$\xi，\eta，\tau$的导数。关于$\xi，\eta，\tau$的导数中的系数称为度量。**例如，$\frac{\partial \xi}{\partial x}，\frac{\partial \xi}{\partial y}，\frac{\partial \eta}{\partial x}，\frac{\partial \eta}{\partial y}$都是度量，它们可以从变换式(1$a$~$c$）中求得。

​		**如果式(1$a$~$c$）是以封闭形式的解析表达式给出，那么度量也可以求出封闭形式的表达式。然而，式(1$a$~$c$）给出的变换常常只是纯数值的对应关系，这种情况下只能用有限差分来计算度量，通常是用中心差分计算。**

​		考虑粘性流动控制方程：方程的粘性项中包含二阶导数，它包括$\frac{\partial (\mu\partial v)}{\partial x^{2}}$这样的项。对这些二阶导数也需要进行变换。用下述的方法来完成。在式（2）中，令
$$
A=\frac{\partial}{\partial x}=(\frac{\partial}{\partial \xi})(\frac{\partial \xi}{\partial x})+(\frac{\partial}{\partial \eta})(\frac{\partial \eta}{\partial x})
$$
​		则有：
$$
\begin{align}
\frac{\partial^{2}}{\partial x^{2}}&=\frac{\partial A}{\partial x}[(\frac{\partial}{\partial \xi})(\frac{\partial \xi}{\partial x})+(\frac{\partial}{\partial \eta})(\frac{\partial \eta}{\partial x})]\\
&=(\frac{\partial}{\partial \xi})(\frac{\partial^{2} \xi}{\partial x^{2}})+(\frac{\partial\xi}{\partial x})(\frac{\partial^{2}}{\partial x\partial\xi})+(\frac{\partial}{\partial \eta})(\frac{\partial^{2} \eta}{\partial x^{2}})+(\frac{\partial\eta}{\partial x})(\frac{\partial^{2}}{\partial x\partial\eta})\tag{5}
\end{align}
$$
​		等式（5）中的最后一步是由两项乘积的求导法则得出的。将等式中的$\frac{\partial^{2}}{\partial x\partial\xi}$和$\frac{\partial^{2}}{\partial x\partial\eta}$分别记作$B和C$，它们所表示的导数是一个“复合导数”，它们包含了关于$(x，y，t)$中的某一个自变量和$（\xi，\eta，\tau）$中另一个自变量的导数。

​		要将$\frac{\partial^{2}}{\partial x^{2}}$完全用关于$\xi，\eta和\tau$的导数来表示。因此还需要对$B和C$做进一步推导。$B$所表示的复合导数可以重写成：
$$
B=\frac{\partial^{2}}{\partial x\partial\xi}=\frac{\partial}{\partial x}(\frac{\partial}{\partial \xi})
$$
​		由方程（2）给出的链锁规则，得到
$$
B=(\frac{\partial^{2}}{\partial \xi^{2}})(\frac{\partial \xi}{\partial x})+(\frac{\partial^{2}}{\partial\eta\partial\xi})(\frac{\partial \eta}{\partial x})\tag{6}
$$
​		同样
$$
B=\frac{\partial^{2}}{\partial x\partial\eta}=\frac{\partial}{\partial x}(\frac{\partial}{\partial \eta})=(\frac{\partial^{2}}{\partial \eta^{2}})(\frac{\partial \eta}{\partial x})+(\frac{\partial^{2}}{\partial \xi\partial\eta})(\frac{\partial \xi}{\partial x})\tag{7}
$$
​		用式（6）和式（7）代替式（5）中B和C所代表的项，并重新排列各项的顺序，得到
$$
\begin{align}
\frac{\partial^{2}}{\partial x^{2}}=&(\frac{\partial}{\partial \xi})(\frac{\partial^{2} \xi}{\partial x^{2}})+(\frac{\partial}{\partial\eta})(\frac{\partial^{2}\eta}{\partial x^{2}})+(\frac{\partial^{2}}{\partial \xi^{2}})(\frac{\partial\xi}{\partial x})^{2}+(\frac{\partial^{2}}{\partial \eta^{2}})(\frac{\partial\eta}{\partial x})^{2}+\\&2(\frac{\partial^{2}}{\partial \eta\partial\xi})(\frac{\partial\eta}{\partial x})(\frac{\partial\xi}{\partial x})\tag{8}
\end{align}
$$
​		以此类推，得到关于$y$的二阶偏导数：
$$
\begin{align}
\frac{\partial^{2}}{\partial y^{2}}=&(\frac{\partial}{\partial \xi})(\frac{\partial^{2} \xi}{\partial y^{2}})+(\frac{\partial}{\partial\eta})(\frac{\partial^{2}\eta}{\partial y^{2}})+(\frac{\partial^{2}}{\partial \xi^{2}})(\frac{\partial\xi}{\partial y})^{2}+(\frac{\partial^{2}}{\partial \eta^{2}})(\frac{\partial\eta}{\partial y})^{2}+\\&2(\frac{\partial^{2}}{\partial \eta\partial\xi})(\frac{\partial\eta}{\partial y})(\frac{\partial\xi}{\partial y})\tag{9}
\end{align}
$$
​		以此类推，得到关于二阶混合偏导数：
$$
\begin{align}
\frac{\partial^{2}}{\partial x\partial y}=&(\frac{\partial}{\partial \xi})(\frac{\partial^{2} \xi}{\partial x\partial y})+(\frac{\partial}{\partial\eta})(\frac{\partial^{2}\eta}{\partial x\partial y})+(\frac{\partial^{2}}{\partial \xi^{2}})(\frac{\partial\xi}{\partial x})(\frac{\partial\xi}{\partial y})+\\
&(\frac{\partial^{2}}{\partial \eta^{2}})(\frac{\partial\eta}{\partial x})(\frac{\partial\eta}{\partial y})+(\frac{\partial^{2}}{\partial \eta\partial\xi})[(\frac{\partial\eta}{\partial x})(\frac{\partial\xi}{\partial y})+(\frac{\partial\xi}{\partial x})(\frac{\partial\eta}{\partial y})]\tag{10}
\end{align}
$$
​		**（详细推导过程见《计算流体力学基础及其应用》第五章）**

​		式（10）利用关于$\xi$和$\eta$的一阶偏导数、二阶偏导数和混合偏导数乘以不同的度量，给出了关于$x$和$y$的二阶混合偏导数。

​		式（1）到式（10）各式，是用来将流动控制方程从物理平面（$（x，y）$平面）变换到计算平面$（（\xi，，n)平面）$的。在大多数$CFD$应用中，这种变换的目的是将物理平面中的***非均匀网格***<img src="CFD与应用.assets/1627537583590.png" style="zoom:50%"/>变换成计算平面中的***均匀网格***<img src="CFD与应用.assets/1627537837454.png" style="zoom:50%"/>

​		变换后的偏微分控制方程就在计算平面上进行有限差分离散。而在计算平面，有着均匀的$\Delta \xi$和均匀的$\Delta t$，如***均匀网格***所示。流场变量的计算是在计算平面的所有网格点（如***均匀网格***中的点$a、b和c$）上进行的。

​		这些流场变量也就是物理平面相应的网格点（***非均匀网格*** 中的点$a、b和c$）上的流场变量。完成这一过程的变换，其一般形式由式（1$a$~$c$）给出。在求解给定的问题时，式（1$a$~$c$）需要具体地给出来。



## 三、度量和雅可比行列式

[目录](#catalog)

​		在**[方程的一般变换](#transformation of the equation)式（2）~式（10）**各式中，涉及网格几何性质的项，如$\frac{\partial \xi}{\partial x}，\frac{\partial \xi}{\partial y}，\frac{\partial \eta}{\partial x}，\frac{\partial \eta}{\partial y}$，称为度量。如果**[方程的一般变换](#transformation of the equation)式（1$a$~$c$）**以解析的形式给出，则度量也可能得到解析的值。然而，在许多CFD应用中，**[方程的一般变换](#transformation of the equation)式（1$a$~$c$）**是以数值的形式给出的，因此度量也要用有限差分计算。

​		利用**[方程的一般变换](#transformation of the equation)式（1$a$~$c$）**逆变换：
$$
x=x(\xi,\eta,\tau)\tag{1d}
$$

$$
y=y(\xi,\eta,\tau)\tag{1e}
$$

$$
t=t(\tau)\tag{1f}
$$

​		在式（1$d$~$f$）中，$\xi，\eta和\tau$是自变量。然而，在导数的**[方程的一般变换](#transformation of the equation)式（2）~式（10）**中，$\frac{\partial \xi}{\partial x}，\frac{\partial \xi}{\partial y}，\frac{\partial \eta}{\partial x}，\frac{\partial \eta}{\partial y}$等度量是以$x ，y和 t$为自变量的偏导数。因此，为了用逆变换式（1$d$~$f$）计算这些方程中的度量，需要建立度量$\frac{\partial \xi}{\partial x}，\frac{\partial \xi}{\partial y}，\frac{\partial \eta}{\partial x}，\frac{\partial \eta}{\partial y}$等与逆度量$\frac{\partial x}{\partial \xi}，\frac{\partial y}{\partial \xi}，\frac{\partial x}{\partial \eta}，\frac{\partial y}{\partial \eta}$等的关系，而这些逆度量能够从**逆变换式（1$d$~$f$）**中直接求得。

​		直接给出直接度量与逆度量之间的关系式：

​		**（详细推导过程见《计算流体力学基础及其应用》第五章）**
$$
\frac{\partial \xi}{\partial x}=\frac{1}{J}\frac{\partial y}{\partial \eta}\tag{2a}
$$

$$
\frac{\partial \eta}{\partial x}=-\frac{1}{J}\frac{\partial y}{\partial \xi}\tag{2b}
$$

$$
\frac{\partial \xi}{\partial y}=-\frac{1}{J}\frac{\partial x}{\partial \eta}\tag{2c}
$$

$$
\frac{\partial \eta}{\partial y}=\frac{1}{J}\frac{\partial x}{\partial \xi}\tag{2d}
$$

​		将式（2$a$~$b$）代入**[方程的一般变换](#transformation of the equation)式（2）**和**[方程的一般变换](#transformation of the equation)式（3）**，得到：
$$
\frac{\partial }{\partial x}=\frac{1}{J}[(\frac{\partial }{\partial \xi})(\frac{\partial y}{\partial \eta})-(\frac{\partial }{\partial \eta})(\frac{\partial y}{\partial \xi})]\tag{3a}
$$

$$
\frac{\partial }{\partial y}=\frac{1}{J}[(\frac{\partial }{\partial \eta})(\frac{\partial x}{\partial \xi})-(\frac{\partial }{\partial \xi})(\frac{\partial y}{\partial \eta})]\tag{3b}
$$

## 四、论适合CFD使用的控制方程

[目录](#catalog)

​		**（详细知识介绍及推导《计算流体力学基础及其应用》第五章）**

​		流动控制方程的强守恒形式，对于空间二维的非定常流，如果没有源项，则方程化成：
$$
\frac{\partial U}{\partial t}+\frac{\partial F}{\partial x}+\frac{\partial G}{\partial y}=0\tag{1}
$$
​		（为简明起见，这里只考虑空间二维$x、y$的情形，而不是三维$x、y、z$的情形。但分析的结论可直接推广到三维。)

​		**问题：在计算平面$（\xi，\eta）$中，方程（1）还能写成强守恒形式吗？也就是说，变换后的方程还能写成**
$$
\frac{\partial U_{1}}{\partial t}+\frac{\partial F_{1}}{\partial x}+\frac{\partial G_{1}}{\partial y}=0\tag{2}
$$
​		**这样的形式吗？式中，$F_{1}$和$G_{1}$是原来的通量 $F$ 和 $G$ 的适当组合。**

​		**强守恒形式对CFD计算有一些优点。如果能，所有的优点就都能在计算平面保持下来。对于这个问题，答案是肯定的。**

<a id="Stretch (compress) mesh">.</a>

## 五、拉伸（压缩）网格

[目录](#catalog)

<img src="CFD与应用.assets/image-20210730085830956.png" style="zoom:72%" />

<center>图（1）——网格拉伸的例子</center>

​		考虑**图（1）**所示的物理平面和计算平面。假设研究的是流过平板的粘性流。在平板的表面附近，速度迅速变化，如物理平面左边画出的速度剖面所示。

​		为了计算这种流动在平板附近的细节，在 $y$ 方向上需要使用细的空间网格。然而，在远离物面的地方，网格可以粗一些，如**图（1）$a$**所示。因此，在垂直方向上，水平网格线的分布越靠近物面应该越密。

​		另一方面，在计算平面上应建立均匀网格，如**图（1）$b$​**所示。考察**图（1）**可以发现，在物理平面中，网格被“拉伸”了。这就好像在一根橡胶筋上画好均匀网格，然后沿着y方向将橡胶筋的上端向上拉。

​		这种网格拉伸，用一个简单的解析变换就能完成
$$
\xi=x\tag{1a}
$$

$$
\eta=ln(y+1)\tag{1b}
$$

​		逆变换是
$$
x=\xi\tag{2a}
$$

$$
y=e^{\eta}-1\tag{2b}
$$

​		借助**图（1）**，可以仔细研究一下这些关系式。在物理平面和计算平面中，垂直网格线沿 $x$ 方向（$\xi$方向）都是均匀分布的，式（1a）和式（2a）就反映了这一点。

​		在物理平面中，$\Delta x$始终是同一个值。在计算平面中，$\Delta \xi$ 也始终不变，而且$\Delta x=\Delta \xi$ 。所以在 $x$ 方向上，网格并没有被拉伸。

​		然而，水平网格线就不是这样了。按照为达成某种目的设计意图，计算平面中的水平线是均匀分布的，$\Delta\eta$​ 始终是一样的。然而在物理平面中，考虑相应的$\Delta y$​值发生了什么变化呢？

​		将式（2b）对$\eta$​求导
$$
\frac{dy}{d\eta}=e^{\eta}
$$
​		或者
$$
dy=e^{\eta}d\eta
$$
​		用有限增量代替$dy$和$d\eta$，近似地得到
$$
\Delta y=e^{\eta}\Delta \eta\tag{3}
$$
​		注意到，对于同一个常量$△\eta$，随着 $\eta$ 变大，即在**图（1）**中离物面越来越远，式（3）中的$△y$值也逐渐增大。换言之，当沿着垂直方向远离物面时，虽然在计算平面是均匀网格，但却得到了逐渐增大的$y$​​值。也就是说，物理平面中的网格沿垂直方向被拉伸了，这就是拉伸网格的含义。		而且，式（2a）和式（2b）给出的直接变换，或式（1a）和式（1b）给出的逆变换，是形成拉伸网格的机理。

​		**例**  考察流动控制方程在物理平面和计算平面发生了哪些变化。为简单起见，假设是定常流，用连续性方程来进行说明。取定常流的连续性方程，在笛卡儿坐标系下，为
$$
\frac{\part(\rho u)}{\partial x}+\frac{\part(\rho u)}{\partial y}=0\tag{4}
$$
这是物理平面的连续性方程。利用**[方程的一般变换](#transformation of the equation)式（2）**和**[方程的一般变换](#transformation of the equation)式（3）**，可将这个方程变换到计算平面，变换后的形式为
$$
\frac{\partial(\rho u)}{\partial \xi}(\frac{\partial\xi}{\partial x})+\frac{\partial(\rho u)}{\partial \eta}(\frac{\partial\eta}{\partial x})+\frac{\partial(\rho u)}{\partial \xi}(\frac{\partial\xi}{\partial y})+\frac{\partial(\rho u)}{\partial \eta}(\frac{\partial\eta}{\partial y})=0\tag{5}
$$
方程（5）中的度量可从直接变换式（1a）和式（1b）中求得，即
$$
\frac{\partial\xi}{\partial x}=1，\frac{\partial \xi}{\partial x}=0，\frac{\partial\eta}{\partial x}=0，\frac{\partial\eta}{\partial y}=\frac{1}{y+1}\tag{6}
$$
将式（6）中的这些度量代人式（5），得到
$$
\frac{\partial(\rho u)}{\partial \xi}+\frac{1}{y+1}\frac{\partial(\rho v)}{\partial \eta}=0\tag{7}
$$
由式（1b），$y+1=e^{\eta}$，因此方程（7）变为
$$
\frac{\partial(\rho u)}{\partial \xi}+\frac{1}{e^{\eta}}\frac{\partial(\rho v)}{\partial \eta}=0
$$
或
$$
e^{\eta}\frac{\partial(\rho u)}{\partial \xi}+\frac{\partial(\rho v)}{\partial \eta}=0\tag{8}
$$
方程（8）是连续性方程在计算平面中的形式。

​		**例** 为了做进一步的论述，我们重作上面的推导过程，但这次是从逆变换式（2a）和式（2b）人手。回到方程（4），利用**度量和雅可比行列式**的逆变换式（3a）和**度量和雅可比行列式**的逆变换式（3b），有
$$
\frac{1}{J}[(\frac{\partial(\rho u)}{\partial \xi})(\frac{\partial y}{\partial \eta})-(\frac{\partial(\rho u)}{\partial \eta})(\frac{\partial y}{\partial \xi})]+\frac{1}{J}[(\frac{\partial(\rho v)}{\partial \eta})(\frac{\partial x}{\partial \xi})-(\frac{\partial(\rho v)}{\partial \xi})(\frac{\partial x}{\partial \eta})]\tag{9}
$$

方程（9）中的逆度量可从逆变换式（2a）和式（2b）中求得，结果是
$$
\frac{\partial x}{\partial\xi}=1，\frac{\partial x}{\partial\eta}=0，\frac{\partial y}{\partial\xi}=0，\frac{\partial y}{\partial\eta}=e^{\eta}\tag{10}
$$

将式（10）代回式（9）得到
$$
e^{\eta}\frac{\partial(\rho u)}{\partial\xi}+\frac{\partial(\rho v)}{\partial\eta}=0\tag{11}
$$

这就是变换后的连续性方程。事实上，方程（11）与方程（8）完全相同。这个例子是为了说明，无论是用直接变换还是用逆变换推导变换后的方程，结果都是一样的。

​		理解这样一个重要的事实，对于流动控制方程的任何变换，正是度量携带着一个具体变换的**所有特定信息。**		**例** 考虑更复杂的网格拉伸变换，研究绕钝体底部的超声速粘性流。此时，网格在 $x$​​ 方向和 $y$​​​ 方向都要进行拉伸。图（2）给出了物理平面和计算平面。根据变换
$$
x=\frac{\xi_{0}}{A}【sinh[(\xi_{0}-x_{0})\beta_{x}+A】\tag{12}
$$
<img src="CFD与应用.assets/image-20210731115058026.png" style="zoom:72%"/>

<center>图（2）均匀网格与压缩网格的比较</center>

进行$x$方向（流向）的拉伸，其中
$$
A=sinh（\beta_{x}x_{0})\tag{13}
$$

$$
x_{0}=\frac{1}{2\beta_{x}}ln\frac{1+(e^{\beta_{x}}-1)\xi_{0}}{1+(e^{-\beta_{x}}-1)\xi_{0}}\tag{14}
$$

式（12）中，$\xi_{0}$是物理平面发生最大聚集的点在计算平面中相应的位置。$\beta_{x}$是常数，控制向 $\xi_{0}$ 点聚集的程度，$\beta_{x}$越大，聚集得就越密。

​		网格沿$y$方向的横向拉伸，需要把物理平面分成：底部后面和底部的上方上下两部分。利用变换
$$
y=\frac{(\beta_{y}+1)-(\beta_{y}-1)e^{-e(\eta-1-\alpha)/(1-\alpha)}}{(2\alpha+1)(1+e^{-e(\eta-1-\alpha)/(1-\alpha)})}\tag{15}
$$
其中
$$
c=log\frac{\beta_{y}+1}{\beta_{y}-1}
$$
​		而 $\beta_{y}$ 和 $\alpha$ 都是常数，对于刚才分出的两个部分(底部的后面和上方，这些常数的取值是不同的。这个代数变换给出了**图（2）**所示的网格拉伸。注意在**图（2）**中，钝体底部本身并没有网格点，因为固体底部的内部显然没有流动。上面给出的变换式(（12）~式（15）都是网格拉伸的例子，不过更复杂些。

​		对于所研究的具体问题，需要选择自己认为最适合的网格拉伸，觉得什么最合适就用什么。

<a id="Body fitted coordinate system: elliptic mesh generation">.</a>

## 六、贴体坐标系：椭圆型网格生成

[目录](#catalog)

​		通过具体问题来考察贴体坐标系。考虑流过**图（1）**所的扩张管道的流动。曲线 $de$ 是管道上壁，直线 $fg$ 是中心线。对于这种流动，物理平面中用简单的矩形网格是不行的。因此，我们**图（1）$a$**中画一些曲线网格，使上边界 $de$ 和中心线都成为坐标线，曲线网格完全贴着边界。接下来，曲线网格（**图（1）$a$**）需要变换成计算平面中的矩形网格（**图（1）$b$**）。

​		用下述方法可以完成这个过程。令$y=f(x)$是**图（1）$a$**中上表面 $de$ 的纵坐标，则下述变换将生成$（\xi，\eta）$​平面内的矩形网格
$$
\xi=x\tag{1}
$$

$$
\eta=\frac{y}{y_{s}}，其中，y_{x}=f(x)\tag{2}
$$

![image-20210731165523556](CFD与应用.assets/image-20210731165523556.png)

<center>图（1）——简单的贴体坐标系</center>

​		例如，考虑物理平面中的 $d$​​ 点，$y=y_{d}=y_{s}(x_{d})$​​。将这点坐标代入式（2）得
$$
\eta_{d}=\frac{y_{d}}{y_{s}}=\frac{y_{s}(x_{d})}{y_{s}(x_{d})}
$$
​		因此，在计算平面中 $d$ 点位于$\eta=\eta_{d}=1$上。现在考虑物理平面中的 $c$ 点。此时 $y=y_{c}=y_{s}(x_{d})$。$C$ 点的纵坐标显然不同于 $d$ 点的纵坐标，即 $y>y_{d}$。把 $y$ 代入式（2）得到
$$
\eta_{c}=\frac{y_{c}}{y_{s}}=\frac{y_{s}(x_{c})}{y_{s}(x_{c})}=1
$$
​		所以在计算平面中，$c$ 点也位于$\eta=\eta_{c}=1$上，与计算平面中点 $d$ 的 $\eta$ 坐标值相同。

​		根据上面的讨论，可以清楚地看到物理平面中沿着上边界曲线的所有点，都落到计算平面中的水平线  ${\eta=1}$上。这就给出了计算平面内的均匀矩形网格。关于物理平面中贴体曲线坐标系，以及将它们变换到计算平面内均匀矩形网格的变换，上面的内容就是最基本的要点。

​		**例** 如图（1）所示，它是为绕翼型的流动设计的。考虑图（1）a，一组曲线环绕着给定的翼型，其中一条坐标线，$000000000000000000\eta=\eta_{1}=$​常数，与翼型的表面重合。这条坐标线是网格的内边界，在图（1）的物理平面和计算平面中都用$\Gamma_{1}$​表示。在图（1）中，用 $\Gamma_{2}$​ 表示网格的外边界，$\eta=\eta_{2}=$​常数。内边界 $\Gamma_{1}$​ 的形状和位置由翼型确定，而外边界 $\Gamma_{2}$​ 的形状和位置则相对任意，可以随便画。

​		考察一下这个网格，显然它是贴着边界的，所以这是一个贴体坐标系。那些从内边界 $\Gamma_{1}$​ 出发，然后与外边界 $\Gamma_{2}$​ 相交的线，是为常数的线，，如线 $ef$​ 是 $\xi=\xi_{1}=$​常数。这些线展开成扇形，每条线上的常数值自己确定。也就是说，对于每一条0$\xi$​=常数的曲线，可以给定的一个数值。例如，可以将曲线 $ef$​ 标记为=0.1，将曲线 $bh$​ 标记为=0，等等。在图（1）$a$​中，还要注意 $\eta$​ 为常数的线是完全包围着翼型的，就像一个个拉长了的圆这样的网格称为翼型的 $O$​ 形网格。另00000000000000000000000000000000000一种曲线gbbbbbbbbbbbbbbbbbbbbbt6t网格是将 $\xi$​ =常数的线向右延伸到下游，而不是完全环绕着翼型（内边界 $\Gamma_{1}$​ 除外），这样的网格称为 $C$​​ 型网格。

<img src="CFD与应用.assets/image-20210731173151718.png" style="zoom:65%"/>

<center>图（1）——椭圆型方法生成的贴体网格</center>

​		**问题：**哪种变换能够将图（1）$a$ 的曲线网格变换成图（1）$b$ 计算平面中的均匀网格？

​		假设，把物理平面中的曲线网格画在一张标有笛卡儿坐标 $(x，y$) 的图纸上。那么，沿着内边界，物理坐标是已知的，即**沿着$\Gamma_{1}，(x，y)$​ 已知**

​		也就是说，对于 $\Gamma_{1}$ 上任意一个给定的点，有两个数是已知的，即该点的 $x$ 坐标和 $y$ 坐标。同样，外边界 $\Gamma_{2}$ 的物理坐标(x，y)也已知，因为 $\Gamma_{2}$ 是绕着翼型任意画的一个圆圈 。一旦$\Gamma_{2}$ 确定了，沿着它的物理坐标 $(x，y)$ 就是已知的。**沿着$\Gamma_{1}，(x，y)$​ 已知**

​		这说明，存在一个边值问题，其中沿着边界的每一点上，边界条件即（ $x$ 和 $y$ 的值）是已知的。回忆《偏微分方程》的内容，求解椭圆型偏微分方程需要沿着包围区域的边界在每一点上给定边界条件。因此，图（1）中的变换可以考虑是由一个椭圆型偏微分方程确定的。（对比一下，拉伸网格情况下的关系式，即**拉伸（压缩）网格式(2a)**和**拉伸（压缩）网格式(2b)**，以及图（1）中给出的形状简单的管道所用的变换关系式，即式（1）和式（2）可都是代数关系式。最简单的椭圆型方程就是 $Laplace$ 方程
$$
\frac{\partial^{2}\xi}{\partial x^{2}}+\frac{\partial^{2}\xi}{\partial y^{2}}=0\tag{3}
$$


$$
\frac{\partial^{2}\eta}{\partial x^{2}}+\frac{\partial^{2}\eta}{\partial y^{2}}\tag{4}
$$

​		在方程（3）和方程（4）中，$\xi$ 和 $\eta$ 是因变量，$x$ 和 $y$ 是自变量。将两组变量对调一下，写出逆方程，使$x$和$y$​​ 变成因变量，结果是
$$
\alpha\frac{\partial^{2}x}{\partial \xi^{2}}-2\beta\frac{\partial^{2}x}{\partial\xi\partial\eta}+\gamma\frac{\partial^{2}x}{\partial\eta^{2}}=0\tag{5}
$$
和
$$
\alpha\frac{\partial^{2}y}{\partial \xi^{2}}-2\beta\frac{\partial^{2}y}{\partial\xi\partial\eta}+\gamma\frac{\partial^{2}y}{\partial\eta^{2}}=0\tag{6}
$$
其中
$$
\alpha=(\frac{\partial x}{\partial\eta})^{2}+(\frac{\partial y}{\partial\eta})^{2}\\
\beta=(\frac{\partial x}{\partial\xi})(\frac{\partial x}{\partial\eta})+(\frac{\partial y}{\partial\xi})(\frac{\partial y}{\partial\eta})\\
\gamma=(\frac{\partial x}{\partial\xi})^{2}+(\frac{\partial y}{\partial\xi})^{2}\\
$$
​		方程(（5）和方程（6）是以$x、y$为因变量，以 $\xi$、$\eta$ 为自变量的椭圆型偏微分方程。

​		在图（1）中，求解方程（5）和方程（6）就是把物理平面中的网格点的 $(x，y)$ 坐标作为 $(\xi， \eta)$ 的函数，用计算平面中对应网格点的 $(\xi， \eta)$ 坐标值计算。

​		对于适定的椭圆型方程的问题，需要沿着区域的整个边界给定边界条件。

​		在图（1）b中，计算平面是用上边界 $\Gamma_{2}$​、下边界 $\Gamma_{1}$​、两侧边界 $\Gamma_{3}$​ 和 $\Gamma_{4}$​ 围起来的区域。

​		到目前为止，只沿着边界 $\Gamma_{1}$ 和 $\Gamma_{2}$ 给定了 $x、y$ 的值，还需要沿着 $\Gamma_{3}$ 和 $\Gamma_{4}$ 给定某种边界条件，才能使问题成为适定的。

​		要完成这一点，回到图（1）a中的物理平面。假设用小刀从 $O$ 形网格的最右端到翼型的后缘处“割”出一条缝。切割的结果产生了两条额外的边界线，即曲线 $qp$ 和 $sr$ ，分别用 $\Gamma_{3}$ 和 $\Gamma_{4}$ 表示。

​		实际上，在 $x$ 平面中，$qb$ 和 $sr$ 是同一条曲线，$qp$ 表示割缝的上沿，$sr$ 表示割缝的下沿，但是它们是互相重合的。

​		在物理平面中，$q$ 点和 $s$ 点重合，$p$ 点和 $r$ 点也重合。实际上，整个 $\Gamma_{3}$ 与 $\Gamma_{3}$ 重合。但是在图（1）b所示的$（\xi， \eta）$计算平面中却不是这样。在这里 $\Gamma_{3}$ 和 $\Gamma_{4}$ 完全分开了，分别构成了计算区域的右边界和左边界。

​		物理平面中的 $O$ 形网格就好像在割开后又被展开了，$\Gamma_{4}$ 向下旋转并转到了左边。在计算平面中，$q$ 点和 $s$ 点是分开的两个网格点，$p$ 点和 $r$ 点也是分开的两个网格点。

​		暂且回到物理平面中，这种切割是非常随意的，但是一旦做了，就确定了沿着割线的 $(x， y)$ 坐标，也就是说得到了沿着 $\Gamma_{3}$ 和的 $x、y$ 值。

​		总结一下物理平面和计算平面之间的关系，有以下结论：在物理平面中，翼型表面曲线 $pgecar$ 被变换成计算平面中用直线 $\Gamma_{1}$ 表示的下边界。

​		同理可知，物理平面中的外边界曲线 $ghfdbs$​ 被变换成计算平面中用直线 $2$​ 表示的上边界。物理平面中的割线则形成了计算平面中矩形的左、右边界，在图（1）b中左边界是用 $\Gamma_{4}$​ 表示的直线 $sr$​，右边界是用 $\Gamma_{3}$​ 表示的直 线$qp$​。

​		下面图（2）又一次画出了计算平面。这里强调，沿着所有四条边界线$\Gamma_{1}$、$\Gamma_{2}$、$\Gamma_{3}$和$\Gamma_{4}$，$(x， y)$ 的值都已知，这是求解椭圆型偏微分方程适定问题的基础，而方程（5）和方程（6）就是这样的椭圆型方程。

​		对计算区域内的每一个网格点，可以用数值方法求解这两个方程，只要沿着$\Gamma_{1}$、$\Gamma_{2}$、$\Gamma_{3}$、$\Gamma_{4}$给定物理平面内相应边界的 $(x，y)$ 坐标作为边界条件。

​		例如，考虑图（2）中标记为 $A$ 的内点，它对应于图（1）中也标记成 $A$ 的点（在物理平面和计算平面内都画了）。在计算平面中的A点上，通过求解方程（5）和方程（6）得到的 $(x， y)$ 值，就确定了物理平面中$A$点的位置。

​		对平面内均匀分布的所有网格点，通过求解方程（5）和方程（6）都可以确定 $x$ 平面内相应网格点的位置，但物理平面内的这些网格点并不一定是均匀分布的了。

​		也就是说，计算平面内给定的网格点$（\xi，\eta）$对应于物理平面内通过计算得到的网格点$（x，y）$。这样的变换是通过求解椭圆型偏微分方程组来实现的，所以称为椭圆型网格生成。

​		在实际应用中，方程式（5）和式（6）可以用椭圆型方程的有限差分方法求解。比如说，松弛法就普遍用于求解这样的方程。

<img src="CFD与应用.assets/2021-07-31_07-54-16277314633413.png" style="zoom:78%"/>

<center>图（2）——计算平面（标出边界条件并画出一个内点）</center>

​		必须指出，上述变换用一个椭圆型偏微分方程来生成网格，但并未给出变换的解析表达式。相反，变换产生一组数值，确定了物理平面内网格点的位置$（x，y）$，而这个网格点对应于计算平面中的网格点 $（\xi，\eta）$ 。

​		**至于流动控制方程中的度量，如 $\frac{\partial\xi}{\partial x}，\frac{\partial\eta}{\partial y}$，可以用有限差分计算，并且常常采用中心差分。**

​		例如，在（不论是物理平面还是计算平面）标记为$（i，j）$的网格点处，可以写出度量的计算公式为
$$
(\frac{\partial\xi}{\partial x})_{i, j}=\frac{\xi_{i+1, j}-\xi_{i-1, j}}{x_{i+1, j}-x_{i-1, j}}
$$
这样计算出来的度量值将被直接代入到变换后的流动控制方程中。然后，在计算平面上，或者说在计算平面的均匀网格上，求解变换后的流动控制方程，从而得到翼型周围的流场。

​		**非常重要的是，要清楚以上步骤是在做什么。方程(5-69)和方程(5-70)与流场的物理量无关。为了把$\xi、\eta$ 和$ x、y$联系起来，选择椭圆型偏微分方程，用它建立了从物理平面到计算平面的变换(网格点之间的一一对应关系)，仅此而已。**

​		<font color=red face="黑体">**上面两句话的意思是说，虽然网格生成的变换是椭圆型方程控制的，但并不是只能用在控制方程为椭圆型的流动中。实际上，流动的控制方程无论是椭圆型、双曲型、还是抛物型的，甚至是混合型的，都可以用椭圆型网格生成方法来生成计算所需的网格。这里的椭圆型方程，只是用来生成网格而已，和流动本身的性质无关。**</font>

​		**由于椭圆型方程控制着这种变换，所以方程（5）和方程（6）是一类网格生成方法（和前面一样，称为椭圆型网格生成方法）中的一个例子。**

​		图（1）a只是定性地显示了贴体曲线坐标系。实用的绕翼型网格见图（3），它就是用上述椭圆型网格生成方法生成的，引自 Kothari等人的计算。图中焦点处的小白点实际上就是翼型。在亚声速流的数值计算中，远场边界必须放在远离物体的地方，所以图中的翼型才如此之小。

​		利用 Thompson的网格生成方法，Kothari和本书作者在Miley翼型周围生成了贴体坐标系(Miley翼型是密西西比州立大学的 Stan Miley为低雷诺数流动而设计的一种特殊翼型)。图中焦点处的小白点就是翼型，网格从翼型的位置向各个方向延伸。

​		通过釆用时间推进有限差分方法求解可压缩纳维斯托克斯方程，计算出了绕翼型的低雷诺数流动。自由来流是亚声速的。由于在亚声速流中扰动会传播得非常远，因此网格的外边界放在了离翼型非常远的地方。图（4）给出了翼型附近网格的细节。不同于图（1）的$O$形网格，图（3）和图（4）中的网格是 $C$ 形网格。

​		在这两个图中，黑色的区域是非常密集的网格点，因为计算机绘图无法分辨出这些网格点。图（3）和图（4）所示的网格真正用在了求解绕翼型的低雷诺数流动中，而计算的结果就是图（5）。

<img src="CFD与应用.assets/image-20210731213200492.png" style="zoom:65%"/>

<center>图（3）——围绕Miley翼型的网格</center>

<img src="CFD与应用.assets/image-20210731213458470.png" style="zoom:65%"/>

<center>图（4）——上图中的贴体网格的一小部分，显示了翼型附近网格分节的细节   
</center>

<img src="CFD与应用.assets/1-4.png" style="zoom:65%"/>

<center>图（5）——CFD数值试验的例子</center>

​		重点：椭圆型网格生成方法只是通过求解椭圆型偏微分方程来获得区域内部的网格点，它完全独立于流动控制方程的有限差分求解。网格是在求解流动控制方程之前就生成的。生成网格时用到 Laplace方程（方程（3）和方程（4），与实际流动的物理性质没有一点关系。 Laplace方程在这里仅仅是用来生成网格的。

## 七、自适应网格

<a id="catalog">目录</a>

​		应该将大量的、密集的网格点分布在流场变量存在大的梯度的那部分流动区域内，从而改进CFD计算的数值精度。这样做不仅是因为密网格能够减小截断误差，更是因为要想捕捉流动的物理特性，梯度大的地方就需要更多的网格点。

​		图（1）给出的流过平板的粘性流，可用来定性地说明这个问题。在实际的物理流动中，随着流向距离的增加，边界层会越来越厚。令 $x$ 是从前缘算起流向距离，当地的边界层厚度是 $\delta=\delta(x)$。

​		在图（1）a所示的粗网格中，没有一个网格点真正落在边界层之内。也就是说，平板上方的第一排网格点，就已经使得$\Delta y>\delta$。在这种网格上进行数值计算，并在壁面上使用无滑移条件 $u=0$​ ，可以得到图（1）a右边所画的速度剖面。

​		这是一个类似于边界层的速度分布，$u$ 沿着 $y$方向不断增加，但是给出的边界层厚度远远超过了实际的边界层厚度。作为对比，考虑图（1）b所示的网格，它在 $y$​ 方向上的网格点数与图（1）a一样多，但是对网格进行了压缩，结果至少有一些网格点落入实际的边界层内。

​		也就是说，平板上第一排网格点满足$\Delta y<8$。在这种网格进行数值计算，得到的速度剖面（图（1）b右边）更真实地表现出了实际的边界层。实质上，图（1）a所示的均匀粗网格完全错过了物理边界层，图中右边所示的类似于粘性流的速度剖面仅仅是因为使用了壁面无滑移条件。

​		相比之下，图（1）b所示的经过压缩的粗网格至少捕捉到了真实边界层的一些特征。

<img src="CFD与应用.assets/image-20210801075649616.png" style="zoom:96%"/>

<center>图（1）——在边界层内需要集中大量的网格点</center>

​		**自适应网格引论：**

​		**显然，压缩(或拉伸)网格的目的是将网格点放在有流动存在的流场里，移走落在几乎没有或完全没有流动的那些区域中的网格点。**

​		**但是，[拉伸（压缩）网格](#Stretch (compress) mesh)所讨论的拉伸网格是在流场求解计算之前用代数方法生成的。而且一旦生成，在流场求解的整个过程中网格位置都不再变化。**

​		**然而，没有实际求解这个问题，怎么能预先知道流动将发生在哪里呢？**

​		**可以事先拉伸网格，但仍可能完全错过实际流动存在的区域。**

​		**也就是说，可能没那么幸运，恰好在流场内的大梯度区域里分布了更密的网格。**

​		**这就是需要考虑自适应网格的原因。**

​		自适应网格是能够自动向流场中大梯度区域聚集的网格，它利用求解的流场特征确定网格点在物理平面中的位置。

​		自适应网格可以认为是一种随（伪）时间变化的网格，在流场控制方程的时间推进求解中，网格的调整与按时间步计算流场变量的过程同步。在这种求解过程中，流场中大的梯度随时间发展，物理平面中的网格点通过移动去“迎合”它。

​		因此，在流场求解的过程中，物理平面中的实际网格点是不断在运动的，只有当流场解趋于定常时这些网格点才会静止下来。[拉伸（压缩）网格](#Stretch (compress) mesh)讨论的拉伸网格和[贴体坐标系：椭圆型网格生成](#Body fitted coordinate system: elliptic mesh generation)讨论的椭圆型网格，网格生成完全独立于流场求解之外。

​		自适应网格则与流场求解密切相关，并随着流场的变化而变化。自

​		适应网格的优点也就与网格点能自动向流动“发生”的区域内聚集这一特性有关。

​		自适应网格的优点是：

​		①当网格数量固定时，可以提高计算精度：

​		②给定精度时，可以用较少的网格点来达到这一精度。

​		（上述优点是否总能得到体现还没有被完全确认）

​		自适应网格的一个简单的例子是 Corda 求解绕后台阶的粘性超声流时所用的网格，其中的坐标变换为
$$
\Delta x=\frac{B\Delta\xi}{1+b(\frac{\partial g}{\partial x})}\tag{1}
$$

$$
\Delta y=\frac{C\Delta\eta}{1+c(\frac{\partial g}{\partial y})}\tag{2}
$$

式中，$g$ 是流场中的原始变量，如 $p、\rho$ 或 $T$。

​		如果 $g=p$​​ ，则式（1）和式（2）使网格点向压力的大梯度区域内聚集；如果 $g=T$​​ ，则网格点向温度的大梯度区域内聚集，依此类推。在式（1）和式（2）中，$\Delta\xi$​​ 和 $\Delta\eta$​​ 是计算平面中均匀网格的间距，并且是固定不变的。

​		常01数 $b$ 和 $c$ 是改变物理平面网格间距时用来增加或降低梯度的；$B$ 和 $C$ 是比例因子，$\Delta x$ 和$\Delta y$是物理平面中新的网格间距由于流场的时间相关解中 $\frac{\partial g}{\partial x}$ 和 $\frac{\partial g}{\partial y}$ 是随时间变化的，所以 $\Delta x$ 和 $\Delta y$ 显然也随时间变化。 

​		这也就是说，物理平面中网格点是移动的。显然，在 $\frac{\partial g}{\partial x}$ 和 $\frac{\partial g}{\partial y}$ 很大的流动区域中，式（1）和式（1）对固定的 $\Delta\xi$ 和 $\Delta\xi$ 给出很小的 $\Delta x$ 和 $\Delta x$ ，这就是使网格点聚集的

![image-20210801153422685](CFD与应用.assets/image-20210801153422685.png)

<center>图（2）——自适应网格原理示意图</center>

原理。图（2）说明了这一过程，其中(a)为物理平面，(b)是计算平面。考虑图中标记为 $N$​ 的网格点。在平面中这个点是固定的，不随时间移动。标记为 $N+1$​ 的相邻网格点也是这样。

​		网格点 $N$ 和 $N+1$ 之间的距离是$\Delta\xi$。现在考察物理平面中对应的网格点（图（2）a）。

​		在物理平面中，$t$ 时刻 $N$ 和 $N+1$ 点的位置用黑色的圆点表示，两点之间的 $x$ 方向距离为 $(\Delta x)^{t}$ ，其中上标 $t$ 表示 $t$ 时刻。$t$ 时刻 $N$ 点的 $x$ 坐标 $x_{N}^{t}$，依赖于1、2点之间的 $\Delta x$ ，2、3点之间的 $\Delta x$，等等。也就是说
$$
x_{N}^{t}=\sum_{1}^{N}(\Delta x)_{i}^{t}\tag{3}
$$
​		现在考虑下一时刻 $t+\Delta t$​ 的情形。由于在时间推进的过程中，$\frac{\partial g}{\partial x}$​ 从一个时刻到下时刻通常会改变，所以式（1）给出 $t+\Delta t$​ 时刻一个新的 $\Delta x$ 值$（\Delta x）^{t+\Delta t}$。

​		因此在 $t+\Delta t$ 时刻，$N$ 点的 $x$ 坐标移到一个新的位置 $x$ 。当然，因为还有式（2），所以 $N$ 点的 $y$ 坐标也在移动。$t+\Delta t$时刻 $N$ 和 $N+1$ 点的新位置在图（2）a中用十字形记号标出。

​		图（2）中同时还标出了 $\Delta x$ 的新值$（\Delta x）^{t+\Delta t}$ 时刻 $N$ 点的 $x$ 坐标为
$$
x_{N}^{t+\Delta t}=\sum_{1}^{N}（\Delta x）_{t}^{t+\Delta t}\tag{4}
$$
​		对于网格点的y坐标，也可以写出与式（3）和式（4）类似的式子。

​		**重点：**处理自适应网格时，计算平面由 $\xi，\eta$ 空间内的固定点组成，这些点不随时间变化。

​		也就是说，这些点在计算平面内是不动的。此外，$\Delta\xi$ 和 $\Delta\eta$ 还都是均匀的。

​		因此，计算平面与前面几节讨论的计算平面是一样的。

​		流动控制方程将在计算平面求解，其中对$x，y$和 $t$​ 的导数用**[方程的一般变换](#transformation of the equation)式（2），式（3）和式（4）**各式进行变换。

​		特别要注意时间导数的[方程的一般变换](#transformation of the equation)式（4）。在[拉伸（压缩）网格](#Stretch (compress) mesh)和[贴体坐标系：椭圆型网格生成](#Body fitted coordinate system: elliptic mesh generation)分别讨论的拉伸网格和贴体网格时，度量 $\frac{\partial\xi}{\partial t}$ 和 $\frac{\partial\eta}{\partial t}$ 为零，所以[方程的一般变换](#transformation of the equation)式（4）变为 $\frac{\partial}{\partial t}$= $\frac{\partial}{\partial\tau}$  。

​		然而，对于自适应网格， $\frac{\partial\xi}{\partial t}\equiv(\frac{\partial\xi}{\partial t})_{x，y}$， $\frac{\partial\eta}{\partial t}\equiv(\frac{\partial\eta}{\partial t})_{x，y}$却是不等于零的。

​		这是因为，虽然计算平面中网格点是固定的，但物理平面中的网格点是随时间移动的。 $(\frac{\partial\xi}{\partial t})_{x，y}$的物理意义是物理平面中固定点$（x，y）$处点的时间变化率。同样$\frac{\partial\eta}{\partial t})_{x，y}$，的物理意义是物理平面中固定点$（x，y）$处的时间变化率。

​		把目光锁定在物理平面中固定的点$（x，y）$处，这一点上的 $\xi$ 和 $\eta$ 作为时间函数是变化的。这就是为什么 $\frac{\partial\xi}{\partial t}$ 和 $\frac{\partial\eta}{\partial t}$ 是非零的。

​		于是，在计算平面中处理变换后的流动方程时，[方程的一般变换](#transformation of the equation)式（4）右边三项都是非零的，并且一定包含在变换后的方程中。

​		在求解流动控制方程的过程中，时间度量 $\frac{\partial\xi}{\partial t}$ 和 $\frac{\partial\eta}{\partial t}$​ 以这种方式自动地将网格的自适应移动考虑了进来。

​		[方程的一般变换](#transformation of the equation)式（4）中的时间度量计算起来有点麻烦，而相应的时间度量更容易 $(\frac{\partial x}{\partial t})_{\xi，\eta}$​ 和 $(\frac{\partial x}{\partial t})_{\xi，\eta}$​  进行计算，可由自适应网格变换式（1）和式（2）直接得出。

​		例如，可以用 $N$ 点和 $N+1$ 点 $x$ 坐标的相应改变量除以时间增量 $t$ 来表示时间度量 $(\frac{\partial x}{\partial t})_{\xi，\eta}$ ，即
$$
(\frac{\partial x}{\partial t})_{\xi，\eta}=\frac{x_{N}^{t+\Delta t}-x_{N}^{t}}{\Delta t}\tag{5a}
$$
式中， $x_{N}^{t+\Delta t}$和 $x_{N}^{t}$ 分别由式（3）和式（4）给出。

​		对 $(\frac{\partial y}{\partial t})_{\xi，\eta}$ ，类似的表达式为
$$
(\frac{\partial x}{\partial t})_{\xi，\eta}=\frac{x_{N}^{t+\Delta t}-x_{N}^{t}}{\Delta t}\tag{5b}
$$
其中，$y_{M}^{t}$ 和 $y_{M}^{t+\Delta t}$由类似于式（3）和式（4）的表达式给出，即
$$
y_{M}^{t}=\sum_{1^{'}}^{M}（\Delta y）_{i}^{t}\\
y_{M}^{t+\Delta t}=\sum_{1^{'}}^{M}（\Delta y）_{i}^{t+\Delta t}
$$
​		考察图（2），先前把目光集中在标记为 $N$ 的网格点上。这里， $N$ 仅仅是 $x$ 的指标，即$i=N$。对于同一网格点，$M$ 表示对应于 $y$ 的指标，即 $j=M$。上面的求和是在 $y$ 方向对图（2）a中的点 $1’，2’，3'$等等进行求和。

​		式（1）和式（2）给出的变换直接给出了时间度量 $(\frac{\partial x}{\partial t})_{\xi，\eta}$ 和 $(\frac{\partial x}{\partial t})_{\xi，\eta}$ ，但是[方程的一般变换](#transformation of the equation)式（4）中出现的却是时间度量 $(\frac{\partial\xi}{\partial t})_{x，y}$ 和 $(\frac{\partial\eta}{\partial t})_{x，y}$  ，所以必须找出这两组度量之间的关系。

​		**详细推导过程见《计算流体力学基础及其应用》第5章**

​		给出结论：

​		注意到 $\tau=t$ ，雅克比行列式 $J$：
$$
J=\left|
	\begin{array}{c}
	(\frac{\partial x}{\partial\xi})_{\eta，\tau}&&(\frac{\partial x}{\partial\eta})_{\xi，\tau}\\
	(\frac{\partial y}{\partial\xi})_{\eta，\tau}&&(\frac{\partial y}{\partial\eta})_{\xi，\tau}
	\end{array}
\right|\tag{6}
$$
​		则有：
$$
\frac{\partial\xi}{\partial t}=\frac{1}{J}[-(\frac{\partial x}{\partial t})(\frac{\partial y}{\partial \eta})+(\frac{\partial y}{\partial t})(\frac{\partial x}{\partial\eta})]\tag{7}
$$
​		类似地：
$$
\frac{\partial\eta}{\partial t}=\frac{1}{J}[(\frac{\partial x}{\partial t})(\frac{\partial y}{\partial\xi})-(\frac{\partial y}{\partial t})(\frac{\partial x}{\partial\xi})]\tag{8}
$$
​		对于在时间推进求解过程中的自适应网格，流动控制方程变换到计算平面内求解时，必须包含时间[方程的一般变换](#transformation of the equation)式（4）中所有的项。

​		[方程的一般变换](#transformation of the equation)式（4）中的时间度量是a/t和。这些时间度量可以分别由式（7）和式（8）计算，而其中的 $\frac{\partial\xi}{\partial t}$ 和 $\frac{\partial\eta}{\partial t}$ 分别用式（5a）和式（5b）求出。

​		至于出现在式（7）和式（8）以及雅可比行列式 $J$​ 中的空间度量，$\frac{\partial x}{\partial\xi}$​、$\frac{\partial x}{\partial\eta}$​、$\frac{\partial y}{\partial\xi}$​和$\frac{\partial y}{\partial\eta}$​，则可以用中心差分来代替：
$$
\frac{\partial x}{\partial\xi}=\frac{x_{i+1，j}-y_{i-1，j}}{2\Delta\xi}\\
\frac{\partial x}{\partial\eta}=\frac{x_{i，j+1}-x_{i，j-1}}{2\Delta\eta}\\
\frac{\partial y}{\partial\xi}=\frac{x_{i+1，j}-y_{i-1，j}}{2\Delta\eta}\\
\frac{\partial y}{\partial\eta}=\frac{y_{i，j+1}-y_{i，j-1}}{2\Delta\eta}
$$
式中，$i=N，j=M$

​		图（3）给出了绕后台阶超声速流自适应网格的例子，流动从左至右。

​		图（3）所示的自适应网格，是在时间推进流场求解达到定常状态之后，最终稳定下来的网格。

​		因为随着流场趋近于定常状态，时间度量 $\frac{\partial x}{\partial\xi}$、$\frac{\partial x}{\partial\eta}$、$\frac{\partial y}{\partial\xi}$和$\frac{\partial y}{\partial\eta}$ 都趋于零，从而使物理 $x，y$ 平面内的网格点停止了移动。

​		从图（3）中可以看到，网格聚集在从台阶拐角出发的稀疏波区域，以及台阶下游的再压缩激波周围。

​		自适应网格本身可以作为一种流场显示方法，用来分辨流场中波系、剪切层以及其他梯度的位置。

​		回到原来的自适应网格的变换式（1）和式（2），式中如果取 $g=ρ$ ，则物理平面中网格点向密度的大梯度区域内聚集，相于实验中的纹影照相。图（3）中的网格就担当了“CFD纹影照片”的角色

![image-20210801182218053](CFD与应用.assets/image-20210801182218053.png)

<center>图（3）——后台阶问题的自适应网格</center>

​		生成自适应网格有许多不同的方法，上面讨论的只是其中的一种方法。在现代CFD中，对自适应网格的研究处于快速发展的状态，因此需要在开始进行自适应网格研究之前，查阅一下与这个主题有关的最新文献。



# 第三章：计算流体力学的基本方法

## 一、学习路线

[目录](#catalog)

​		必须指出，任何一种具体的CFD方法都不可能适用于所有的流动问题。不同的偏微分方程具有各种各样的数学性质，某些算法适用于双曲型方程，而另一些算法则适用于椭圆型方程。这里仅构造通用的方法，把对具体问题的具体应用放在第四章及之后。

​		为简单起见，只考虑二维流动。在需要的时候，总是假设气体为常比热容完全气体。本章内容的路线图将在图（1）中给出，其中列举了本章研究的各种方法及其适用性。

​		这张图非常重要。

![image-20210802065756285](CFD与应用.assets/image-20210802065756285.png)

<center>图（1）——学习路线图</center>

<a id="Lax-Wendroff">.</a>

## 二、拉克斯—温德罗夫$(Lax-Wendroff)$​​方法

（$Lax-Wendroff$方法的另一实例参考《伯格斯方程数值解》）

[目录](#catalog)

​		拉克斯-温德罗夫方法是一种显式有限差分方法，特别适合于推进求解。是通过沿时间空间逐步推进而得到数值解的思想，这种推进解法是与双曲型和物型偏微分方程的求解相关联的。

​		对于双曲型方程控制的流动问题，一个很好的例子就是粘流非定常欧拉方程的时间推进解法。这种时间推进解法，为了便于阐述，考虑非定常二维无粘流的模型。

​		下面将方程写成非守恒形式：

连续性方程
$$
\frac{\partial\rho}{\partial t}=-(\rho\frac{\partial u}{\partial x}+u\frac{\partial\rho}{\partial x}+\rho\frac{\partial v}{\partial y}+v\frac{\partial\rho}{\partial y})\tag{1}
$$
$x$​方向的动量方程
$$
\frac{\partial u}{\partial t}=-(u\frac{\partial u}{\partial x}+v\frac{\partial u}{\partial y}+\frac{1}{\rho}\frac{\partial\rho}{\partial x})\tag{2}
$$
$y$​方向的动量方程
$$
\frac{\partial v}{\partial t}=-(u\frac{\partial v}{\partial x}+v\frac{\partial v}{\partial y}+\frac{1}{\rho}\frac{\partial\rho}{\partial y})\tag{3}
$$
能量方程
$$
\frac{\partial e}{\partial t}=-(u\frac{\partial e}{\partial x}+v\frac{\partial e}{\partial y}+\frac{p}{\rho}\frac{\partial u}{\partial x}+\frac{p}{\rho}\frac{\partial v}{\partial y})\tag{4}
$$
​		在上面的方程中，假设了没有体积力和体积加热，也就是说， $f=0$，$\delta q=0$。方程（1）~方程（4）对时间变量是双曲型的。

​		现在用时间推进法对方程（1）~方程（4）进行数值求解。将方程已经整理成一种便于时间推进的形式时间导数都在方程的左边，空间导数都在方程的右边。拉克斯温德罗夫方法的基础是时间导数的泰勒级数展开式。任意选择一个流动参量，为明确起见，选择密度 $\rho$。

![image-20210802072759378](CFD与应用.assets/image-20210802072759378.png)

<center>图（2）——矩形网格</center>

​		选择图（2）所示的二维网格，用 $\rho_{i，j}^{t}$ 表示在 $t$ 时刻网格点 $(i， j)$ 处的密度，那么在 $t+\Delta t$ 时刻同一网格点 $(i， j)$ 处的密度 $\rho_{i ，j}^{t+\Delta t}$ 可由泰勒级数给出
$$
\rho_{i ,j}^{t+\Delta t}=\rho_{i ,j}^{t}+(\frac{\partial\rho}{\partial t})_{i,j}^{t}(\Delta t)+(\frac{\partial^{2}\rho}{\partial t^{2}})_{i,j}^{t}\frac{(\Delta t)^{2}}{2}+\cdots\tag{5}
$$
​		使用式（5）的时候，假设 $t$ 时刻的流场是已知的，则式（5）给出了 $t+\Delta t$时刻的新流场。

​		在式（5）中， $\rho_{i，j}^{t}$ 可以从 $t$ 时刻的流场得知，如果能够得到 $(\frac{\partial\rho}{\partial t})_{i，j}^{t})$ 和 $(\frac{\partial^{2}\rho}{\partial t^{2}})_{i，j}^{t}$，，那么下一时刻的密度值 $\rho_{i ，j}^{t+\Delta t}$ 就能显式地从式（5）中计算出来。

​		类似地，泰勒级数展开对其他流动参量也适用，例如
$$
u_{i ,j}^{t+\Delta t}=u_{i ,j}^{t}+(\frac{\partial u}{\partial t})_{i,j}^{t}(\Delta t)+(\frac{\partial^{2} u}{\partial t^{2}})_{i,j}^{t}\frac{(\Delta t)^{2}}{2}+\cdots\tag{6}
$$

$$
v_{i ,j}^{t+\Delta t}=v_{i ,j}^{t}+(\frac{\partial v}{\partial t})_{i,j}^{t}(\Delta t)+(\frac{\partial^{2} v}{\partial t^{2}})_{i,j}^{t}\frac{(\Delta t)^{2}}{2}+\cdots\tag{7}
$$

$$
e_{i ,j}^{t+\Delta t}=e_{i ,j}^{t}+(\frac{\partial e}{\partial t})_{i,j}^{t}(\Delta t)+(\frac{\partial^{2} e}{\partial t^{2}})_{i,j}^{t}\frac{(\Delta t)^{2}}{2}+\cdots\tag{8}
$$

​		已知t时刻的$\rho_{i ，j}^{t}$，$u_{i，j}^{t}$，$v_{i ，j}^{t}$和$e_{i ，j}^{t}$值，只要能够求出它们在t时刻的时间导数，也就是能够求出式（5）—式（8）右边的 $(\frac{\partial\rho}{\partial t})_{i，j}^{t}$、 $(\frac{\partial u}{\partial t})_{i，j}^{t}$、$(\frac{\partial^{2} u}{\partial t^{2}})_{i，j}^{t}$ 等导数的值，就可以用式（5）—式（8）将每个网格点处的流场变量推进到下一时刻。

​		显然，式（5）—式（8）只是数学上的关系式，流动的物理性质必须通过某种方式引入到计算中。物理性质指的是用来确定时间导数 $(\frac{\partial\rho}{\partial t})_{i，j}^{t}$、$(\frac{\partial^{2}\rho}{\partial t^{2}})_{i，j}^{t}$ 等的物理条件，这些物理性质体现在流动控制方程（1）—（4）中。		比如，用式（5）计算 $t+\Delta t$ 时刻的密度。这个等式中的 $(\frac{\partial\rho}{\partial t})_{i，j}^{t}$​，应该从连续性方程（1）得到。将方程（1）中的空间导数由二阶中心差分出，即
$$
(\frac{\partial\rho}{\partial t})^{t}_{i，j}=-&(\rho_{i ,j}^{t}\frac{u_{i+1，j}^{t}-u_{i-1，j}^{t}}{2\Delta x}+u_{i，j}^{t}\frac{\rho_{i+1，j}^{t}-\rho_{i-1，j}^{t}}{2\Delta x}+\\
&\rho_{i ,j}^{t}\frac{v_{i，j+1}^{t}-v_{i，j-1}^{t}}{2\Delta x}+v_{i ,j}^{t}\frac{\rho_{i，j+1}^{t}-\rho_{i，j-1}^{t}}{2\Delta x})\tag{9}
$$
​		因为 $t$​ 时刻的流场是已知的，所以式(（9）边的量全都是已知的。于是式（9）给出了 $(\frac{\partial\rho}{\partial t})_{i，j}^{t}$​ 的值，把这个导数值带入式（5），就解决了式（5）右端的第二项。

​		第三项 $(\frac{\partial^{2}\rho}{\partial t^{2}})_{i，j}^{t}$，也可用类似的方式得到，但需要更复杂的计算。

​		还是以密度的计算为例。将方程（1）对时间求导，得到
$$
\frac{\partial^{2}\rho}{\partial t^{2}}=-(\rho\frac{\partial^{2}u}{\partial x\partial t}+\frac{\partial u}{\partial x}\frac{\partial\rho}{\partial t}+u\frac{\partial^{2}\rho}{\partial x\partial t}+\frac{\partial\rho}{\partial x}\frac{\partial u}{\partial t}+\rho\frac{\partial^{2}v}{\partial y\partial t}+\frac{\partial v}{\partial y}\frac{\partial\rho}{\partial t}+v\frac{\partial^{2}\rho}{\partial y\partial t}+\frac{\partial\rho}{\partial y}\frac{\partial v}{\partial t})\tag{10}
$$
​		上式中的 $(\frac{\partial^{2}u}{\partial x\partial t})$ 等二阶混合导数，可由方程式（1）—式（4）对相应的空间自变量求导得到。

​		例如， $(\frac{\partial^{2}u}{\partial x\partial t})$ ，可由方程（2）对 $x$ 求导得到
$$
\frac{\partial^{2}u}{\partial x\partial t}=-[u\frac{\partial^{2}u}{\partial x^{2}}+(\frac{\partial u}{\partial x})^{2}+v\frac{\partial^{2}v}{\partial x\partial y}+\frac{\partial u}{\partial y}\frac{\partial v}{\partial x}+\frac{1}{\rho}\frac{\partial^{2}p}{\partial x^{2}}-\frac{1}{\rho^{2}}\frac{\partial p}{\partial x}\frac{\partial\rho}{\partial x}\tag{11}]
$$
​		式（11）中，右边所有的项还是由t时刻的二阶中心有限差分表示，即
$$
(\frac{\partial^{2}u}{\partial x\partial t})_{i，j}^{t}=-&[u_{i，j}^{t}\frac{u_{i+1，j}^{t}-2u_{i，j}^{t}+u_{i-1，j}^{t}}{(\Delta x)^{2}}+(\frac{u_{i+1，j}^{t}-u_{i-1，j}^{t}}{2\Delta x})^{2}+\\
&v_{i，j}^{t}\frac{u_{i，j+1}^{t}+u_{i-1，j-1}^{t}-u_{i-1，j+1}^{t}-u_{i+1，j-1}^{t}}{4(\Delta x)(\Delta y)}+\\
&\frac{u_{i，j+1}^{t}-u_{i，j-1}^{t}}{2\Delta y}\times\frac{v_{i+1，j}^{t}-v_{i-1，j}^{t}}{2\Delta x}+\frac{1}{\rho_{i，j}^{t}}\times\frac{p_{i+1，j}^{t}-2p_{i，j}^{t}+p_{i-1，j}^{t}}{(\Delta x)^{2}}-\\
&\frac{1}{(\rho_{i，j}^{t})^{2}}\times\frac{p_{i+1，j}^{t}-p_{i-1，j}^{t}}{(2\Delta x)}\times\frac{\rho_{i+1，j}^{t}-\rho_{i-1，j}^{t}}{(2\Delta x)}]\tag{12}
$$
​		式（12）右边所有的项都可以从t时刻的已知流场得到，此式给出了导数 $(\frac{\partial^{2}u}{\partial x\partial t})_{i，j}^{t}$​ 的值。然后用这个值代替式（10）中的 $(\frac{\partial^{2}u}{\partial x\partial t})$​ 就可以了。

​		继续计算式（10）。 $(\frac{\partial^{2}\rho}{\partial x\partial t})$​ 这一项可通过把方程（1）对 $x$ 求导，然后用二阶中心差分代替方程右边的空间导数项求得，这与式（12）的计算类似。

​		同样， $(\frac{\partial^{2}v}{\partial y\partial t})$ 可通过把方程（3）对 $y$ 求导，然后用二阶中心差分代替方程右边的空间导数项求得；混合导数项 $(\frac{\partial^{2}\rho}{\partial y\partial t})$ 可通过把方程（1）对 $y$ 求导，然后用二阶中心差分代替方程右边的空间导数项求得。

​		这样一来，式（10）右边只剩下一阶空间导数$\frac{\partial u}{\partial x}$​、$\frac{\partial v}{\partial y}$​、$\frac{\partial\rho}{\partial x}$​、$\frac{\partial\rho}{\partial y}$​和一阶时间导数$\frac{\partial\rho}{\partial t}$​、$\frac{\partial u}{\partial t}$​、$\frac{\partial v}{\partial t}$​​。一阶空间导数仍由二阶中心差分代替，如
$$
(\frac{\partial u}{\partial x})_{i，j}^{t}=\frac{u_{i，j}^{t}-u_{i-1，j}^{t}}{2\Delta x}
$$
​		一阶时间导数，$\frac{\partial\rho}{\partial t}$​​ 的值已从式（9）求得。

​		$\frac{\partial u}{\partial t}$ 和 $\frac{\partial v}{\partial t}$ 可用相同的方式得到，也就是用二阶中心差分分别代替方程式（2）和式（3）右端的各项。

​		有了所有这些值，可以从式（10）中得到 $(\frac{\partial^{2}\rho}{\partial t^{2}})$​ 的值。接下来，把这个值代入式（5）。因为 $\frac{\partial\rho}{\partial t}$​ 已从式（9）得到，所以现在知道了式（5）右边三项在t时刻的值，即$\rho_{i，j}^{t}$​ 、$(\frac{\partial\rho}{\partial t})_{i，j}^{t}$​ 和$(\frac{\partial^{2}\rho}{\partial t^{2}})_{i，j}^{t}$​ 。这样就可以用式（5）计算出 $t+\Delta t$ 时刻的密度值 $\rho^{t+\Delta t}_{i，j}$。

​		对网格点 ($i，j$) 处其他流场变量在 $t+\Delta t$ 时刻的值，只需重复上面的过程就可以得到。

​		为了得到速度的 $x$​ 方向分量 $u$​ 在 $t+\Delta t$​ 时刻的值，只需把由方程（2）得到的 $(\frac{\partial u}{\partial t})^{t}$​ 的值和 $(\frac{\partial^{2}u}{\partial t^{2}})^{t}$​ 的值代入式（6），其中求$(\frac{\partial^{2}u}{\partial t^{2}})^{t}$​ 的值的方法和前面对密度的计算方法一样。

​		为得到速度的 $y$​​ 方向分量 $v$​​ 在 $t+\Delta t$​​ 时刻的值 $t+\Delta t$​​ ，可以使用式（7），其中$(\frac{\partial v}{\partial t})^{t}$​​ 和$(\frac{\partial^{2}v}{\partial t^{2}})^{t}$​​ 从方程（3）中得到。

​		为了得到内能在 $t+\Delta t$ 时刻的值 $e_{i，j}^{t+\Delta t}$ ，可使用式（8），其中的$(\frac{\partial e}{\partial t})^{t}$ 和$(\frac{\partial^{2}e}{\partial t^{2}})^{t}$ 从方程（6）中得到。用这种方法，网格点$(i，j)$处的流场变量在 $t+\Delta t$​ 时刻的值就全部求出来了。

<img src="CFD与应用.assets/image-20210802195645295.png" alt="image-20210802195645295" style="zoom:80%;" />

<center>图（3）——时间推进用的网格</center>

​		图（3）给出了上述计算过程中用到的网格，图中显示了 $t$​ 时刻到 $t+\Delta t$​ 时刻两个时间平面上的空间网格。

​		从图（3）可以清楚地看到，利用 $t$​ 时刻流场变量在网格点 $(i，j)$​、$(i+1，，j)$​ 和 $(i，j+1)$​ 处的已知值，拉克斯—温德罗夫方法可以显式地求出网格点 $(i，j)$​ 处流场变量在 $t+\Delta t$​​ 时刻的值。

​		流场所有网格点处的流场变量在 $t+\Delta t$​ 时刻的值，都可通过这样的方法得到。拉克斯—温德罗夫方法在时间和空间上都具有二阶精度。



## 三、麦考马克$( MacCormack)$​​​方法

[目录](#catalog)

​		[拉克斯—温德罗夫$(Lax-Wendroff)$方法](#Lax-Wendroff)欧拉方程（1）~方程（4）的求解采用了拉克斯温德罗夫方法的时间推进解法。讨论一种类似的时间推进解法，但采用的是麦考马克方法。重新研究[拉克斯—温德罗夫$(Lax-Wendroff)$方法](#Lax-Wendroff)图（2）中的二维网格。

​		和前面一样，假设在t时刻，已知图6-1中每个网格点处的流场，要计算这些网格点处流场变量在t+Mt时刻的值，如[拉克斯—温德罗夫$(Lax-Wendroff)$方法](#Lax-Wendroff)图（3）所示。还是先考虑密度，即网格点(i，j)处的密度在t+△t时刻的值。在麦考马克方法里，密度用下式得到
$$

$$
